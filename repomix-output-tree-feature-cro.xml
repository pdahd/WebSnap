This file is a merged representation of the entire codebase, combined into a single document by Repomix.
The content has been processed where security check has been disabled.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Security check has been disabled - content may contain sensitive information
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  workflows/
    android.yml
    pack-for-ai.yml
app/
  src/
    main/
      assets/
        home.html
      java/
        com/
          example/
            websnap/
              Bookmark.kt
              BookmarkAdapter.kt
              BookmarkManager.kt
              CropActivity.kt
              CropBitmapHolder.kt
              CropImageView.kt
              CropOverlayView.kt
              MainActivity.kt
              RefreshService.kt
              RefreshTask.kt
      res/
        color/
          button_text_color_refresh.xml
          button_text_color.xml
          crop_button_text_color.xml
        drawable/
          bottom_bar_metallic.xml
          bottom_sheet_handle_metallic.xml
          bottom_sheet_handle.xml
          bottom_sheet_metallic.xml
          button_crop_outline.xml
          button_outline_icon.xml
          button_outline.xml
          button_refresh_outline.xml
          checkbox_background.xml
          current_task_background.xml
          dialog_background_metallic.xml
          dialog_background_timepicker.xml
          edit_text_background.xml
          edit_text_outline.xml
          ic_launcher_background.xml
          ic_launcher_foreground.xml
          icon_button_background.xml
          input_field_outline.xml
          pc_button_background.xml
          spinner_background.xml
          time_picker_background.xml
          top_bar_metallic.xml
        layout/
          activity_crop.xml
          activity_main.xml
          bottom_sheet_bookmarks.xml
          bottom_sheet_refresh.xml
          dialog_custom_interval.xml
          item_bookmark.xml
        mipmap-anydpi-v26/
          ic_launcher_round.xml
          ic_launcher.xml
        mipmap-hdpi/
          ic_launcher_round.xml
          ic_launcher.xml
        values/
          arrays.xml
          colors.xml
          strings.xml
          themes.xml
        xml/
          file_paths.xml
          network_security_config.xml
      AndroidManifest.xml
  build.gradle.kts
  proguard-rules.pro
.gitignore
build.gradle.kts
gradle.properties
README.md
settings.gradle.kts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".github/workflows/android.yml">
name: Android CI

on:
  push:
    # å°† feature-crop åŠ å…¥ç›‘æ§åå•
    branches: [ "main", "master", "feature-cro" ]
  pull_request:
    branches: [ "main", "master", "feature-cro" ]
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘æ„å»º
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ============================================
      # æ­¥éª¤ 1: æ£€å‡ºä»£ç 
      # ============================================
      - name: Checkout repository
        uses: actions/checkout@v4

      # ============================================
      # æ­¥éª¤ 2: è®¾ç½® JDK 17
      # ============================================
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # ============================================
      # æ­¥éª¤ 3: è®¾ç½® Gradleï¼ˆæ— éœ€ wrapperï¼‰
      # ============================================
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4
        with:
          gradle-version: '8.2'

      # ============================================
      # æ­¥éª¤ 4: ç”Ÿæˆ Gradle Wrapperï¼ˆä¾›åç»­æ­¥éª¤ä½¿ç”¨ï¼‰
      # ============================================
      - name: Generate Gradle Wrapper
        run: gradle wrapper --gradle-version 8.2

      # ============================================
      # æ­¥éª¤ 5: æ„å»º Debug APK
      # ============================================
      - name: Build Debug APK
        run: ./gradlew assembleDebug --no-daemon --stacktrace

      # ============================================
      # æ­¥éª¤ 6: ä¸Šä¼  APK äº§ç‰©
      # ============================================
      - name: Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: WebSnap-debug-${{ github.sha }}
          path: app/build/outputs/apk/debug/*.apk
          retention-days: 30
          if-no-files-found: error

      # ============================================
      # æ­¥éª¤ 7: æ˜¾ç¤ºæ„å»ºäº§ç‰©ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
      # ============================================
      - name: Display APK info
        run: |
          echo "âœ… Build completed successfully!"
          echo "ğŸ“¦ APK files:"
          ls -lh app/build/outputs/apk/debug/
</file>

<file path=".github/workflows/pack-for-ai.yml">
name: Pack Codebase for AI

on:
  workflow_dispatch: 

jobs:
  pack:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Run Repomix
        # åˆ é™¤äº† --yes å‚æ•°
        # å¦‚æœä½ æƒ³æ‰“åŒ…æ›´å…¨ï¼Œå¯ä»¥ç›´æ¥ç”¨ npx repomix
        run: npx repomix --output my-project-for-ai.txt

      - name: Upload result
        uses: actions/upload-artifact@v4
        with:
          name: project-pack-for-ai
          path: my-project-for-ai.txt
</file>

<file path="app/src/main/assets/home.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebSnap</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            /* é˜²æ­¢è§¦æ‘¸æ—¶çš„é»˜è®¤è¡Œä¸º */
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* ç²’å­ç”»å¸ƒ - å…¨å±èƒŒæ™¯ */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* å†…å®¹å±‚ - å…è®¸è§¦æ‘¸ç©¿é€ */
        .content {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            pointer-events: none;
        }

        /* ä¸»æ ‡é¢˜ */
        .title {
            font-size: 42px;
            font-weight: 300;
            letter-spacing: 0.3em;
            color: #FFFFFF;
            text-transform: uppercase;
            margin-bottom: 16px;
            text-indent: 0.3em;
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }

        /* å‰¯æ ‡é¢˜ */
        .subtitle {
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 0.15em;
            color: #64B5F6;
            margin-bottom: 50px;
            text-indent: 0.15em;
        }

        /* åŠŸèƒ½åŒº */
        .features {
            display: flex;
            gap: 40px;
            margin-bottom: 50px;
        }

        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .feature-icon {
            font-size: 28px;
            filter: drop-shadow(0 0 8px rgba(100, 181, 246, 0.5));
        }

        .feature-text {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.85);
            letter-spacing: 0.1em;
        }

        /* åœºæ™¯æè¿° */
        .scene {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 0.08em;
            margin-bottom: 12px;
        }

        /* å¹³å°åˆ—è¡¨ */
        .platforms {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 0.05em;
        }

        /* åº•éƒ¨ GitHub */
        .footer {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* GitHub é“¾æ¥ - æ¢å¤å¯ç‚¹å‡» */
        .github-link {
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.35);
            font-size: 11px;
            letter-spacing: 0.03em;
            transition: color 0.3s ease;
            pointer-events: auto;
        }

        .github-link:hover,
        .github-link:active {
            color: rgba(255, 255, 255, 0.7);
        }

        .github-logo {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <!-- ç²’å­ç”»å¸ƒ -->
    <canvas id="particleCanvas"></canvas>

    <!-- å†…å®¹å±‚ -->
    <div class="content">
        <h1 class="title">WebSnap</h1>
        <p class="subtitle">Keep Your Session Alive</p>

        <div class="features">
            <div class="feature-item">
                <span class="feature-icon">ğŸ”„</span>
                <span class="feature-text">é—´éš”åˆ·æ–°</span>
            </div>
            <div class="feature-item">
                <span class="feature-icon">ğŸ•</span>
                <span class="feature-text">å®šæ—¶åˆ·æ–°</span>
            </div>
        </div>

        <p class="scene">ä¸“ä¸ºäº‘ç«¯è™šæ‹ŸæœºæœåŠ¡è®¾è®¡</p>
        <p class="platforms">Firebase Studio Â· Colab</p>

        <div class="footer">
            <a href="https://github.com/pdahd/WebSnap" class="github-link">
                <svg class="github-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                </svg>
                <span>pdahd/WebSnap</span>
            </a>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ç²’å­å®‡å®™ - å¼•åŠ›æ˜Ÿç³»æ•ˆæœ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');

        // é…ç½®å‚æ•°
        const CONFIG = {
            particleCount: 100,
            colors: ['#64B5F6', '#E0F7FA', '#FFFFFF', '#81D4FA', '#B3E5FC'],
            minSize: 1,
            maxSize: 3,
            gravityStrength: 0.00003,
            initialSpeed: 0.3,
            damping: 0.9995,
            trailAlpha: 0.08,
            // è§¦æ‘¸æ’æ–¥å‚æ•°
            repelRadius: 150,
            repelStrength: 0.8
        };

        // ç²’å­æ•°ç»„
        let particles = [];
        let centerX, centerY;

        // è§¦æ‘¸/é¼ æ ‡ä½ç½®
        let pointerX = -1000;
        let pointerY = -1000;
        let isPointerActive = false;

        // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
        }

        // åˆ›å»ºå•ä¸ªç²’å­
        function createParticle() {
            const angle = Math.random() * Math.PI * 2;
            const distance = 100 + Math.random() * Math.max(canvas.width, canvas.height) * 0.4;
            const x = centerX + Math.cos(angle) * distance;
            const y = centerY + Math.sin(angle) * distance;

            // åˆ‡å‘é€Ÿåº¦ï¼ˆå‚ç›´äºåˆ°ä¸­å¿ƒçš„æ–¹å‘ï¼‰
            const tangentAngle = angle + Math.PI / 2;
            const speed = CONFIG.initialSpeed * (0.5 + Math.random() * 0.5);

            return {
                x: x,
                y: y,
                vx: Math.cos(tangentAngle) * speed,
                vy: Math.sin(tangentAngle) * speed,
                size: CONFIG.minSize + Math.random() * (CONFIG.maxSize - CONFIG.minSize),
                color: CONFIG.colors[Math.floor(Math.random() * CONFIG.colors.length)],
                alpha: 0.5 + Math.random() * 0.5
            };
        }

        // åˆå§‹åŒ–æ‰€æœ‰ç²’å­
        function initParticles() {
            particles = [];
            for (let i = 0; i < CONFIG.particleCount; i++) {
                particles.push(createParticle());
            }
        }

        // æ›´æ–°ç²’å­ä½ç½®
        function updateParticle(p) {
            // è®¡ç®—åˆ°ä¸­å¿ƒçš„è·ç¦»å’Œæ–¹å‘ï¼ˆå¼•åŠ›ï¼‰
            const dxCenter = centerX - p.x;
            const dyCenter = centerY - p.y;
            const distCenterSq = dxCenter * dxCenter + dyCenter * dyCenter;
            const distCenter = Math.sqrt(distCenterSq);

            // å¼•åŠ›åŠ é€Ÿåº¦ï¼ˆF = G / rÂ²ï¼‰
            if (distCenter > 10) {
                const force = CONFIG.gravityStrength * distCenterSq / distCenter;
                p.vx += (dxCenter / distCenter) * force;
                p.vy += (dyCenter / distCenter) * force;
            }

            // è§¦æ‘¸æ’æ–¥æ•ˆæœ
            if (isPointerActive) {
                const dxPointer = p.x - pointerX;
                const dyPointer = p.y - pointerY;
                const distPointer = Math.sqrt(dxPointer * dxPointer + dyPointer * dyPointer);
                
                if (distPointer < CONFIG.repelRadius && distPointer > 0) {
                    const repelForce = (CONFIG.repelRadius - distPointer) / CONFIG.repelRadius * CONFIG.repelStrength;
                    p.vx += (dxPointer / distPointer) * repelForce;
                    p.vy += (dyPointer / distPointer) * repelForce;
                }
            }

            // åº”ç”¨é˜»å°¼
            p.vx *= CONFIG.damping;
            p.vy *= CONFIG.damping;

            // æ›´æ–°ä½ç½®
            p.x += p.vx;
            p.y += p.vy;

            // è¾¹ç•Œç¯ç»•
            const margin = 50;
            if (p.x < -margin) p.x = canvas.width + margin;
            if (p.x > canvas.width + margin) p.x = -margin;
            if (p.y < -margin) p.y = canvas.height + margin;
            if (p.y > canvas.height + margin) p.y = -margin;
        }

        // ç»˜åˆ¶ç²’å­
        function drawParticle(p) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.alpha;
            ctx.fill();

            // å‘å…‰æ•ˆæœ
            const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size * 3);
            gradient.addColorStop(0, p.color);
            gradient.addColorStop(1, 'transparent');
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size * 3, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.globalAlpha = p.alpha * 0.3;
            ctx.fill();

            ctx.globalAlpha = 1;
        }

        // åŠ¨ç”»ä¸»å¾ªç¯
        function animate() {
            // åŠé€æ˜è¦†ç›–å®ç°æ‹–å°¾æ•ˆæœ
            ctx.fillStyle = `rgba(0, 0, 0, ${CONFIG.trailAlpha})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰ç²’å­
            particles.forEach(p => {
                updateParticle(p);
                drawParticle(p);
            });

            requestAnimationFrame(animate);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // è§¦æ‘¸/é¼ æ ‡äº¤äº’ - ç»‘å®šåˆ° document å®ç°å…¨å±å“åº”
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function handlePointerStart(x, y) {
            pointerX = x;
            pointerY = y;
            isPointerActive = true;
        }

        function handlePointerMove(x, y) {
            pointerX = x;
            pointerY = y;
            isPointerActive = true;
        }

        function handlePointerEnd() {
            isPointerActive = false;
            pointerX = -1000;
            pointerY = -1000;
        }

        // è§¦æ‘¸äº‹ä»¶
        document.addEventListener('touchstart', (e) => {
            const touch = e.touches[0];
            handlePointerStart(touch.clientX, touch.clientY);
        }, { passive: true });

        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            handlePointerMove(touch.clientX, touch.clientY);
        }, { passive: false });

        document.addEventListener('touchend', () => {
            handlePointerEnd();
        }, { passive: true });

        document.addEventListener('touchcancel', () => {
            handlePointerEnd();
        }, { passive: true });

        // é¼ æ ‡äº‹ä»¶ï¼ˆç”¨äºæ¡Œé¢è°ƒè¯•ï¼‰
        document.addEventListener('mousedown', (e) => {
            handlePointerStart(e.clientX, e.clientY);
        });

        document.addEventListener('mousemove', (e) => {
            if (isPointerActive) {
                handlePointerMove(e.clientX, e.clientY);
            }
        });

        document.addEventListener('mouseup', () => {
            handlePointerEnd();
        });

        document.addEventListener('mouseleave', () => {
            handlePointerEnd();
        });

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°åˆå§‹åŒ–
        window.addEventListener('resize', () => {
            resizeCanvas();
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // å¯åŠ¨
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        resizeCanvas();
        initParticles();

        // åˆå§‹æ¸…å±
        ctx.fillStyle = '#000000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        animate();
    </script>
</body>
</html>
</file>

<file path="app/src/main/java/com/example/websnap/Bookmark.kt">
package com.example.websnap

import org.json.JSONObject

/**
 * ä¹¦ç­¾æ•°æ®ç±»
 *
 * @property title ç½‘é¡µæ ‡é¢˜
 * @property url ç½‘é¡µåœ°å€ï¼ˆä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼‰
 */
data class Bookmark(
    val title: String,
    val url: String
) {
    /**
     * è½¬æ¢ä¸º JSON å¯¹è±¡
     */
    fun toJson(): JSONObject {
        return JSONObject().apply {
            put(KEY_TITLE, title)
            put(KEY_URL, url)
        }
    }

    companion object {
        private const val KEY_TITLE = "title"
        private const val KEY_URL = "url"

        /**
         * ä» JSON å¯¹è±¡è§£æä¹¦ç­¾
         */
        fun fromJson(json: JSONObject): Bookmark {
            return Bookmark(
                title = json.optString(KEY_TITLE, ""),
                url = json.optString(KEY_URL, "")
            )
        }
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/BookmarkAdapter.kt">
package com.example.websnap

import android.view.LayoutInflater
import android.view.ViewGroup
import androidx.recyclerview.widget.DiffUtil
import androidx.recyclerview.widget.RecyclerView
import com.example.websnap.databinding.ItemBookmarkBinding

/**
 * ä¹¦ç­¾åˆ—è¡¨é€‚é…å™¨
 */
class BookmarkAdapter(
    private val onItemClick: (Bookmark) -> Unit,
    private val onDeleteClick: (Bookmark, Int) -> Unit
) : RecyclerView.Adapter<BookmarkAdapter.BookmarkViewHolder>() {

    private val bookmarks: MutableList<Bookmark> = mutableListOf()

    /**
     * æ›´æ–°ä¹¦ç­¾åˆ—è¡¨æ•°æ®
     */
    fun submitList(newBookmarks: List<Bookmark>) {
        val diffCallback = BookmarkDiffCallback(bookmarks, newBookmarks)
        val diffResult = DiffUtil.calculateDiff(diffCallback)

        bookmarks.clear()
        bookmarks.addAll(newBookmarks)

        diffResult.dispatchUpdatesTo(this)
    }

    /**
     * ç§»é™¤æŒ‡å®šä½ç½®çš„ä¹¦ç­¾ï¼ˆå¸¦åŠ¨ç”»ï¼‰
     */
    fun removeAt(position: Int) {
        if (position >= 0 && position < bookmarks.size) {
            bookmarks.removeAt(position)
            notifyItemRemoved(position)
            notifyItemRangeChanged(position, bookmarks.size - position)
        }
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): BookmarkViewHolder {
        val binding = ItemBookmarkBinding.inflate(
            LayoutInflater.from(parent.context),
            parent,
            false
        )
        return BookmarkViewHolder(binding)
    }

    override fun onBindViewHolder(holder: BookmarkViewHolder, position: Int) {
        holder.bind(bookmarks[position])
    }

    override fun getItemCount(): Int = bookmarks.size

    /**
     * ViewHolder
     */
    inner class BookmarkViewHolder(
        private val binding: ItemBookmarkBinding
    ) : RecyclerView.ViewHolder(binding.root) {

        init {
            // ç‚¹å‡»æ•´è¡Œ â†’ æ‰“å¼€ä¹¦ç­¾
            binding.root.setOnClickListener {
                @Suppress("DEPRECATION")
                val position = adapterPosition
                if (position != RecyclerView.NO_POSITION) {
                    onItemClick(bookmarks[position])
                }
            }

            // ç‚¹å‡»åˆ é™¤æŒ‰é’®
            binding.buttonDelete.setOnClickListener {
                @Suppress("DEPRECATION")
                val position = adapterPosition
                if (position != RecyclerView.NO_POSITION) {
                    onDeleteClick(bookmarks[position], position)
                }
            }
        }

        fun bind(bookmark: Bookmark) {
            binding.textViewTitle.text = bookmark.title.ifBlank { bookmark.url }
            binding.textViewUrl.text = bookmark.url
        }
    }

    /**
     * DiffUtil å›è°ƒ
     */
    private class BookmarkDiffCallback(
        private val oldList: List<Bookmark>,
        private val newList: List<Bookmark>
    ) : DiffUtil.Callback() {

        override fun getOldListSize(): Int = oldList.size

        override fun getNewListSize(): Int = newList.size

        override fun areItemsTheSame(oldItemPosition: Int, newItemPosition: Int): Boolean {
            return oldList[oldItemPosition].url == newList[newItemPosition].url
        }

        override fun areContentsTheSame(oldItemPosition: Int, newItemPosition: Int): Boolean {
            return oldList[oldItemPosition] == newList[newItemPosition]
        }
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/BookmarkManager.kt">
package com.example.websnap

import android.content.Context
import android.content.SharedPreferences
import org.json.JSONArray
import org.json.JSONException

/**
 * ä¹¦ç­¾ç®¡ç†å™¨
 *
 * è´Ÿè´£ä¹¦ç­¾çš„å¢åˆ æŸ¥æ“ä½œï¼Œä½¿ç”¨ SharedPreferences å­˜å‚¨ JSON æ ¼å¼æ•°æ®ã€‚
 * é‡‡ç”¨å•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿å…¨å±€æ•°æ®ä¸€è‡´æ€§ã€‚
 */
class BookmarkManager private constructor(context: Context) {

    private val prefs: SharedPreferences = context.getSharedPreferences(
        PREFS_NAME,
        Context.MODE_PRIVATE
    )

    /** å†…å­˜ç¼“å­˜ï¼Œé¿å…é¢‘ç¹è¯»å–ç£ç›˜ */
    private val bookmarks: MutableList<Bookmark> = mutableListOf()

    /** æ•°æ®å˜åŒ–ç›‘å¬å™¨ */
    private val listeners: MutableSet<OnBookmarkChangeListener> = mutableSetOf()

    init {
        // åˆå§‹åŒ–æ—¶ä» SharedPreferences åŠ è½½æ•°æ®
        loadFromPrefs()
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å…¬å¼€ API
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * è·å–æ‰€æœ‰ä¹¦ç­¾ï¼ˆè¿”å›å‰¯æœ¬ï¼Œé˜²æ­¢å¤–éƒ¨ä¿®æ”¹ï¼‰
     */
    fun getAll(): List<Bookmark> {
        return bookmarks.toList()
    }

    /**
     * æ£€æŸ¥ URL æ˜¯å¦å·²å­˜åœ¨äºä¹¦ç­¾ä¸­
     */
    fun contains(url: String): Boolean {
        val normalizedUrl = normalizeUrl(url)
        return bookmarks.any { normalizeUrl(it.url) == normalizedUrl }
    }

    /**
     * æ·»åŠ ä¹¦ç­¾
     *
     * @return true æ·»åŠ æˆåŠŸï¼Œfalse URL å·²å­˜åœ¨
     */
    fun add(bookmark: Bookmark): Boolean {
        val normalizedUrl = normalizeUrl(bookmark.url)

        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        val existingIndex = bookmarks.indexOfFirst {
            normalizeUrl(it.url) == normalizedUrl
        }

        if (existingIndex != -1) {
            // URL å·²å­˜åœ¨ï¼Œæ›´æ–°æ ‡é¢˜
            val existing = bookmarks[existingIndex]
            if (existing.title != bookmark.title) {
                bookmarks[existingIndex] = bookmark
                saveToPrefs()
                notifyListeners()
            }
            return false
        }

        // æ·»åŠ æ–°ä¹¦ç­¾ï¼ˆæ’å…¥åˆ°åˆ—è¡¨å¼€å¤´ï¼Œæœ€æ–°çš„åœ¨æœ€å‰é¢ï¼‰
        bookmarks.add(0, bookmark)
        saveToPrefs()
        notifyListeners()
        return true
    }

    /**
     * æ ¹æ® URL ç§»é™¤ä¹¦ç­¾
     *
     * @return è¢«ç§»é™¤çš„ä¹¦ç­¾ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› null
     */
    fun remove(url: String): Bookmark? {
        val normalizedUrl = normalizeUrl(url)
        val index = bookmarks.indexOfFirst {
            normalizeUrl(it.url) == normalizedUrl
        }

        if (index == -1) {
            return null
        }

        val removed = bookmarks.removeAt(index)
        saveToPrefs()
        notifyListeners()
        return removed
    }

    /**
     * æ ¹æ®ç´¢å¼•ç§»é™¤ä¹¦ç­¾
     *
     * @return è¢«ç§»é™¤çš„ä¹¦ç­¾
     */
    fun removeAt(index: Int): Bookmark? {
        if (index < 0 || index >= bookmarks.size) {
            return null
        }

        val removed = bookmarks.removeAt(index)
        saveToPrefs()
        notifyListeners()
        return removed
    }

    /**
     * è·å–ä¹¦ç­¾æ•°é‡
     */
    fun count(): Int = bookmarks.size

    /**
     * ä¹¦ç­¾åˆ—è¡¨æ˜¯å¦ä¸ºç©º
     */
    fun isEmpty(): Boolean = bookmarks.isEmpty()

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç›‘å¬å™¨ç®¡ç†
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * æ·»åŠ æ•°æ®å˜åŒ–ç›‘å¬å™¨
     */
    fun addListener(listener: OnBookmarkChangeListener) {
        listeners.add(listener)
    }

    /**
     * ç§»é™¤æ•°æ®å˜åŒ–ç›‘å¬å™¨
     */
    fun removeListener(listener: OnBookmarkChangeListener) {
        listeners.remove(listener)
    }

    private fun notifyListeners() {
        listeners.forEach { it.onBookmarkChanged() }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ•°æ®æŒä¹…åŒ–
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * ä» SharedPreferences åŠ è½½ä¹¦ç­¾æ•°æ®
     */
    private fun loadFromPrefs() {
        bookmarks.clear()

        val jsonString = prefs.getString(KEY_BOOKMARKS, null) ?: return

        try {
            val jsonArray = JSONArray(jsonString)
            for (i in 0 until jsonArray.length()) {
                val jsonObject = jsonArray.getJSONObject(i)
                val bookmark = Bookmark.fromJson(jsonObject)
                if (bookmark.url.isNotBlank()) {
                    bookmarks.add(bookmark)
                }
            }
        } catch (e: JSONException) {
            e.printStackTrace()
            // JSON è§£æå¤±è´¥ï¼Œæ¸…ç©ºæ•°æ®
            bookmarks.clear()
        }
    }

    /**
     * ä¿å­˜ä¹¦ç­¾æ•°æ®åˆ° SharedPreferences
     */
    private fun saveToPrefs() {
        val jsonArray = JSONArray()
        bookmarks.forEach { bookmark ->
            jsonArray.put(bookmark.toJson())
        }

        prefs.edit()
            .putString(KEY_BOOKMARKS, jsonArray.toString())
            .apply()
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å·¥å…·æ–¹æ³•
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * æ ‡å‡†åŒ– URLï¼Œç”¨äºæ¯”è¾ƒ
     * ç§»é™¤æœ«å°¾æ–œæ ï¼Œç»Ÿä¸€å°å†™åè®®
     */
    private fun normalizeUrl(url: String): String {
        return url.trim()
            .trimEnd('/')
            .lowercase()
            .let { 
                // ç»Ÿä¸€ http/https å‰ç¼€æ ¼å¼
                if (it.startsWith("http://")) it
                else if (it.startsWith("https://")) it
                else "https://$it"
            }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç›‘å¬å™¨æ¥å£
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * ä¹¦ç­¾æ•°æ®å˜åŒ–ç›‘å¬å™¨
     */
    interface OnBookmarkChangeListener {
        fun onBookmarkChanged()
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å•ä¾‹
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    companion object {
        private const val PREFS_NAME = "websnap_bookmarks"
        private const val KEY_BOOKMARKS = "bookmarks"

        @Volatile
        private var instance: BookmarkManager? = null

        /**
         * è·å– BookmarkManager å•ä¾‹
         */
        fun getInstance(context: Context): BookmarkManager {
            return instance ?: synchronized(this) {
                instance ?: BookmarkManager(context.applicationContext).also {
                    instance = it
                }
            }
        }
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/CropActivity.kt">
package com.example.websnap

import android.content.ContentValues
import android.graphics.Bitmap
import android.graphics.RectF
import android.net.Uri
import android.os.Build
import android.os.Bundle
import android.os.Environment
import android.provider.MediaStore
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.example.websnap.databinding.ActivityCropBinding
import java.io.IOException
import java.text.SimpleDateFormat
import java.util.Date
import java.util.Locale

/**
 * å›¾ç‰‡è£å‰ªç•Œé¢
 */
class CropActivity : AppCompatActivity() {

    private lateinit var binding: ActivityCropBinding

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç”Ÿå‘½å‘¨æœŸ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        binding = ActivityCropBinding.inflate(layoutInflater)
        setContentView(binding.root)

        // æ£€æŸ¥æ˜¯å¦æœ‰å¾…è£å‰ªçš„å›¾ç‰‡
        if (!CropBitmapHolder.hasBitmap()) {
            showToast(getString(R.string.toast_crop_no_image))
            finish()
            return
        }

        setupViews()
        setupListeners()
    }

    override fun onDestroy() {
        // é€€å‡ºæ—¶æ¸…ç† Bitmap
        CropBitmapHolder.clear()
        super.onDestroy()
    }

    @Deprecated("Deprecated in Java")
    override fun onBackPressed() {
        CropBitmapHolder.clear()
        @Suppress("DEPRECATION")
        super.onBackPressed()
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // åˆå§‹åŒ–
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun setupViews() {
        val bitmap = CropBitmapHolder.bitmap ?: return

        // è®¾ç½®å›¾ç‰‡
        binding.cropImageView.setBitmap(bitmap)

        // å…³è”è£å‰ªè¦†ç›–å±‚
        binding.cropOverlayView.setCropImageView(binding.cropImageView)

        // ç­‰å¾…å¸ƒå±€å®Œæˆåæ›´æ–°è£å‰ªæ¡†
        binding.cropImageView.post {
            binding.cropOverlayView.updateImageBounds()
        }
    }

    private fun setupListeners() {
        // å–æ¶ˆæŒ‰é’®
        binding.buttonCancel.setOnClickListener {
            showToast(getString(R.string.toast_crop_cancelled))
            CropBitmapHolder.clear()
            finish()
        }

        // é‡ç½®æŒ‰é’®
        binding.buttonReset.setOnClickListener {
            binding.cropImageView.resetToFitView()
            binding.cropOverlayView.resetCropRect()
        }

        // ä¿å­˜æŒ‰é’®
        binding.buttonSave.setOnClickListener {
            performCropAndSave()
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // è£å‰ªä¸ä¿å­˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun performCropAndSave() {
        val originalBitmap = CropBitmapHolder.bitmap
        if (originalBitmap == null || originalBitmap.isRecycled) {
            showToast(getString(R.string.toast_crop_no_image))
            finish()
            return
        }

        // è·å–è£å‰ªåŒºåŸŸï¼ˆBitmap åƒç´ åæ ‡ï¼‰
        val cropRectInBitmap = binding.cropOverlayView.getCropRectInBitmap()

        // éªŒè¯è£å‰ªåŒºåŸŸ
        if (!isValidCropRect(cropRectInBitmap, originalBitmap)) {
            showToast(getString(R.string.toast_crop_area_too_small))
            return
        }

        try {
            // æ‰§è¡Œè£å‰ª
            val croppedBitmap = cropBitmap(originalBitmap, cropRectInBitmap)

            // ä¿å­˜åˆ°ç›¸å†Œ
            val saved = saveBitmapToGallery(croppedBitmap)
            croppedBitmap.recycle()

            if (saved) {
                showToast(getString(R.string.toast_crop_saved))
                CropBitmapHolder.clear()
                finish()
            } else {
                showToast(getString(R.string.toast_crop_failed))
            }

        } catch (e: Exception) {
            e.printStackTrace()
            showToast(getString(R.string.toast_crop_failed))
        }
    }

    private fun isValidCropRect(rect: RectF, bitmap: Bitmap): Boolean {
        // çº¦æŸåˆ° Bitmap è¾¹ç•Œå†…
        rect.left = rect.left.coerceIn(0f, bitmap.width.toFloat())
        rect.top = rect.top.coerceIn(0f, bitmap.height.toFloat())
        rect.right = rect.right.coerceIn(0f, bitmap.width.toFloat())
        rect.bottom = rect.bottom.coerceIn(0f, bitmap.height.toFloat())

        // æ£€æŸ¥æœ€å°å°ºå¯¸
        return rect.width() >= 50f && rect.height() >= 50f
    }

    private fun cropBitmap(source: Bitmap, rect: RectF): Bitmap {
        val x = rect.left.toInt().coerceAtLeast(0)
        val y = rect.top.toInt().coerceAtLeast(0)
        var width = rect.width().toInt()
        var height = rect.height().toInt()

        // ç¡®ä¿ä¸è¶…å‡ºè¾¹ç•Œ
        if (x + width > source.width) {
            width = source.width - x
        }
        if (y + height > source.height) {
            height = source.height - y
        }

        return Bitmap.createBitmap(source, x, y, width, height)
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ä¿å­˜åˆ°ç›¸å†Œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun saveBitmapToGallery(bitmap: Bitmap): Boolean {
        val timestamp = SimpleDateFormat("yyyyMMdd_HHmmss", Locale.getDefault())
            .format(Date())
        val filename = "WebSnap_Crop_$timestamp.png"

        val contentValues = ContentValues().apply {
            put(MediaStore.Images.Media.DISPLAY_NAME, filename)
            put(MediaStore.Images.Media.MIME_TYPE, "image/png")
            put(MediaStore.Images.Media.DATE_ADDED, System.currentTimeMillis() / 1000)
            put(MediaStore.Images.Media.DATE_MODIFIED, System.currentTimeMillis() / 1000)

            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {
                put(
                    MediaStore.Images.Media.RELATIVE_PATH,
                    "${Environment.DIRECTORY_PICTURES}/WebSnap"
                )
                put(MediaStore.Images.Media.IS_PENDING, 1)
            }
        }

        val resolver = contentResolver
        var imageUri: Uri? = null

        return try {
            imageUri = resolver.insert(
                MediaStore.Images.Media.EXTERNAL_CONTENT_URI,
                contentValues
            ) ?: throw IOException("Failed to create MediaStore entry")

            resolver.openOutputStream(imageUri)?.use { outputStream ->
                val compressed = bitmap.compress(
                    Bitmap.CompressFormat.PNG,
                    100,
                    outputStream
                )
                if (!compressed) {
                    throw IOException("Failed to compress bitmap")
                }
            } ?: throw IOException("Failed to open output stream")

            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {
                contentValues.clear()
                contentValues.put(MediaStore.Images.Media.IS_PENDING, 0)
                resolver.update(imageUri, contentValues, null, null)
            }

            true

        } catch (e: Exception) {
            e.printStackTrace()

            imageUri?.let {
                try {
                    resolver.delete(it, null, null)
                } catch (ignored: Exception) {
                }
            }

            false
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å·¥å…·æ–¹æ³•
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun showToast(message: String) {
        Toast.makeText(this, message, Toast.LENGTH_SHORT).show()
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/CropBitmapHolder.kt">
package com.example.websnap

import android.graphics.Bitmap

/**
 * Bitmap æŒæœ‰è€…å•ä¾‹
 *
 * ç”¨äºåœ¨ Activity é—´ä¼ é€’å¤§å›¾ç‰‡ï¼Œé¿å… Intent çš„ Binder é™åˆ¶ã€‚
 * ä½¿ç”¨ååŠ¡å¿…è°ƒç”¨ clear() é‡Šæ”¾å†…å­˜ã€‚
 */
object CropBitmapHolder {

    /** å¾…è£å‰ªçš„åŸå§‹ Bitmap */
    var bitmap: Bitmap? = null
        private set

    /** æˆªå›¾ç±»å‹æ ‡è®° */
    var isFullPage: Boolean = false
        private set

    /**
     * è®¾ç½®å¾…è£å‰ªçš„ Bitmap
     */
    fun set(bitmap: Bitmap, isFullPage: Boolean) {
        // å…ˆé‡Šæ”¾æ—§çš„
        clear()
        this.bitmap = bitmap
        this.isFullPage = isFullPage
    }

    /**
     * æ¸…ç©ºå¹¶é‡Šæ”¾ Bitmap
     */
    fun clear() {
        bitmap?.recycle()
        bitmap = null
        isFullPage = false
    }

    /**
     * æ˜¯å¦æœ‰å¯ç”¨çš„ Bitmap
     */
    fun hasBitmap(): Boolean = bitmap != null && !bitmap!!.isRecycled
}
</file>

<file path="app/src/main/java/com/example/websnap/CropImageView.kt">
package com.example.websnap

import android.annotation.SuppressLint
import android.content.Context
import android.graphics.Bitmap
import android.graphics.Canvas
import android.graphics.Matrix
import android.graphics.RectF
import android.util.AttributeSet
import android.view.GestureDetector
import android.view.MotionEvent
import android.view.ScaleGestureDetector
import android.view.View

/**
 * å¯ç¼©æ”¾å¹³ç§»çš„å›¾ç‰‡è§†å›¾
 *
 * æ”¯æŒï¼š
 * - åŒæŒ‡ç¼©æ”¾ï¼ˆpinch zoomï¼‰
 * - å•æŒ‡/åŒæŒ‡å¹³ç§»ï¼ˆpanï¼‰
 * - åŒå‡»è¿˜åŸï¼ˆdouble tap to resetï¼‰
 * - è¾¹ç•Œé™åˆ¶ï¼ˆä¸ä¼šæ»‘å‡ºå¯è§†åŒºåŸŸï¼‰
 */
class CropImageView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = 0
) : View(context, attrs, defStyleAttr) {

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¸¸é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    companion object {
        /** æœ€å°ç¼©æ”¾æ¯”ä¾‹ï¼ˆç›¸å¯¹äºé€‚åº”å±å¹•çš„åŸºå‡†ï¼‰ */
        private const val MIN_SCALE = 0.5f

        /** æœ€å¤§ç¼©æ”¾æ¯”ä¾‹ */
        private const val MAX_SCALE = 5.0f
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // çŠ¶æ€å˜é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /** è¦æ˜¾ç¤ºçš„ Bitmap */
    private var bitmap: Bitmap? = null

    /** å˜æ¢çŸ©é˜µï¼ˆç”¨äºç¼©æ”¾å’Œå¹³ç§»ï¼‰ */
    private val imageMatrix = Matrix()

    /** ç”¨äºè¯»å–çŸ©é˜µå€¼çš„ä¸´æ—¶æ•°ç»„ */
    private val matrixValues = FloatArray(9)

    /** å›¾ç‰‡åœ¨å˜æ¢åçš„è¾¹ç•ŒçŸ©å½¢ */
    private val imageRect = RectF()

    /** åŸºå‡†ç¼©æ”¾æ¯”ä¾‹ï¼ˆè®©å›¾ç‰‡é€‚åº” View å®½åº¦ï¼‰ */
    private var baseScale = 1f

    /** å½“å‰ç›¸å¯¹ç¼©æ”¾æ¯”ä¾‹ï¼ˆ1.0 = åŸºå‡†å¤§å°ï¼‰ */
    private var currentRelativeScale = 1f

    /** å›¾ç‰‡å˜åŒ–ç›‘å¬å™¨ */
    private var onMatrixChangeListener: OnMatrixChangeListener? = null

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ‰‹åŠ¿æ£€æµ‹å™¨
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /** ç¼©æ”¾æ‰‹åŠ¿æ£€æµ‹å™¨ */
    private val scaleGestureDetector = ScaleGestureDetector(
        context,
        object : ScaleGestureDetector.SimpleOnScaleGestureListener() {

            override fun onScale(detector: ScaleGestureDetector): Boolean {
                val scaleFactor = detector.scaleFactor

                // è®¡ç®—æ–°çš„ç¼©æ”¾æ¯”ä¾‹
                val newRelativeScale = currentRelativeScale * scaleFactor

                // é™åˆ¶ç¼©æ”¾èŒƒå›´
                if (newRelativeScale < MIN_SCALE || newRelativeScale > MAX_SCALE) {
                    return true
                }

                // ä»¥ç„¦ç‚¹ä¸ºä¸­å¿ƒç¼©æ”¾
                imageMatrix.postScale(
                    scaleFactor,
                    scaleFactor,
                    detector.focusX,
                    detector.focusY
                )

                currentRelativeScale = newRelativeScale
                constrainMatrix()
                invalidate()
                notifyMatrixChanged()

                return true
            }
        }
    )

    /** æ™®é€šæ‰‹åŠ¿æ£€æµ‹å™¨ï¼ˆç”¨äºå¹³ç§»å’ŒåŒå‡»ï¼‰ */
    private val gestureDetector = GestureDetector(
        context,
        object : GestureDetector.SimpleOnGestureListener() {

            override fun onScroll(
                e1: MotionEvent,
                e2: MotionEvent,
                distanceX: Float,
                distanceY: Float
            ): Boolean {
                // å¹³ç§»å›¾ç‰‡
                imageMatrix.postTranslate(-distanceX, -distanceY)
                constrainMatrix()
                invalidate()
                notifyMatrixChanged()
                return true
            }

            override fun onDoubleTap(e: MotionEvent): Boolean {
                // åŒå‡»è¿˜åŸåˆ°åˆå§‹çŠ¶æ€
                resetToFitView()
                return true
            }
        }
    )

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å…¬å¼€ API
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * è®¾ç½®è¦æ˜¾ç¤ºçš„ Bitmap
     */
    fun setBitmap(bmp: Bitmap?) {
        this.bitmap = bmp
        if (bmp != null && width > 0 && height > 0) {
            resetToFitView()
        } else {
            invalidate()
        }
    }

    /**
     * è·å–å½“å‰ Bitmap
     */
    fun getBitmap(): Bitmap? = bitmap

    /**
     * é‡ç½®åˆ°é€‚åº” View çš„åˆå§‹çŠ¶æ€
     */
    fun resetToFitView() {
        val bmp = bitmap ?: return
        if (width <= 0 || height <= 0) return

        imageMatrix.reset()

        // è®¡ç®—åŸºå‡†ç¼©æ”¾æ¯”ä¾‹ï¼šè®©å›¾ç‰‡å®½åº¦é€‚åº” View å®½åº¦
        baseScale = width.toFloat() / bmp.width.toFloat()

        // å¦‚æœç¼©æ”¾åé«˜åº¦è¶…å‡º Viewï¼Œåˆ™æ”¹ä¸ºé€‚åº”é«˜åº¦
        val scaledHeight = bmp.height * baseScale
        if (scaledHeight > height) {
            baseScale = height.toFloat() / bmp.height.toFloat()
        }

        // åº”ç”¨ç¼©æ”¾
        imageMatrix.setScale(baseScale, baseScale)

        // å±…ä¸­æ˜¾ç¤º
        val scaledWidth = bmp.width * baseScale
        val finalScaledHeight = bmp.height * baseScale
        val dx = (width - scaledWidth) / 2f
        val dy = (height - finalScaledHeight) / 2f
        imageMatrix.postTranslate(dx, dy)

        currentRelativeScale = 1f
        invalidate()
        notifyMatrixChanged()
    }

    /**
     * è·å–å›¾ç‰‡åœ¨ View åæ ‡ç³»ä¸­çš„è¾¹ç•ŒçŸ©å½¢
     */
    fun getImageBounds(): RectF {
        val bmp = bitmap ?: return RectF()
        imageRect.set(0f, 0f, bmp.width.toFloat(), bmp.height.toFloat())
        imageMatrix.mapRect(imageRect)
        return RectF(imageRect)
    }

    /**
     * å°† View åæ ‡è½¬æ¢ä¸º Bitmap åƒç´ åæ ‡
     */
    fun viewToBitmapCoord(viewX: Float, viewY: Float): FloatArray {
        val inverse = Matrix()
        imageMatrix.invert(inverse)

        val points = floatArrayOf(viewX, viewY)
        inverse.mapPoints(points)

        return points
    }

    /**
     * å°† Bitmap åƒç´ åæ ‡è½¬æ¢ä¸º View åæ ‡
     */
    fun bitmapToViewCoord(bmpX: Float, bmpY: Float): FloatArray {
        val points = floatArrayOf(bmpX, bmpY)
        imageMatrix.mapPoints(points)
        return points
    }

    /**
     * è·å–å½“å‰ç¼©æ”¾æ¯”ä¾‹ï¼ˆç›¸å¯¹äºåŸå›¾ï¼‰
     */
    fun getCurrentScale(): Float {
        imageMatrix.getValues(matrixValues)
        return matrixValues[Matrix.MSCALE_X]
    }

    /**
     * è®¾ç½®çŸ©é˜µå˜åŒ–ç›‘å¬å™¨
     */
    fun setOnMatrixChangeListener(listener: OnMatrixChangeListener?) {
        this.onMatrixChangeListener = listener
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // View ç”Ÿå‘½å‘¨æœŸ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    override fun onSizeChanged(w: Int, h: Int, oldw: Int, oldh: Int) {
        super.onSizeChanged(w, h, oldw, oldh)
        if (bitmap != null) {
            resetToFitView()
        }
    }

    override fun onDraw(canvas: Canvas) {
        super.onDraw(canvas)

        val bmp = bitmap ?: return

        canvas.save()
        canvas.concat(imageMatrix)
        canvas.drawBitmap(bmp, 0f, 0f, null)
        canvas.restore()
    }

    @SuppressLint("ClickableViewAccessibility")
    override fun onTouchEvent(event: MotionEvent): Boolean {
        // å…ˆè®©ç¼©æ”¾æ£€æµ‹å™¨å¤„ç†
        scaleGestureDetector.onTouchEvent(event)

        // å¦‚æœä¸åœ¨ç¼©æ”¾è¿‡ç¨‹ä¸­ï¼Œè®©æ™®é€šæ‰‹åŠ¿æ£€æµ‹å™¨å¤„ç†
        if (!scaleGestureDetector.isInProgress) {
            gestureDetector.onTouchEvent(event)
        }

        return true
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å†…éƒ¨æ–¹æ³•
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * çº¦æŸçŸ©é˜µï¼Œé˜²æ­¢å›¾ç‰‡æ»‘å‡ºå¯è§†åŒºåŸŸ
     */
    private fun constrainMatrix() {
        val bmp = bitmap ?: return

        // è·å–å˜æ¢åçš„å›¾ç‰‡è¾¹ç•Œ
        imageRect.set(0f, 0f, bmp.width.toFloat(), bmp.height.toFloat())
        imageMatrix.mapRect(imageRect)

        var dx = 0f
        var dy = 0f

        val viewWidth = width.toFloat()
        val viewHeight = height.toFloat()

        // æ°´å¹³æ–¹å‘çº¦æŸ
        when {
            imageRect.width() <= viewWidth -> {
                // å›¾ç‰‡å®½åº¦å°äº Viewï¼Œå±…ä¸­
                dx = (viewWidth - imageRect.width()) / 2f - imageRect.left
            }
            imageRect.left > 0 -> {
                // å·¦è¾¹æœ‰ç©ºéš™ï¼Œå¾€å·¦æ¨
                dx = -imageRect.left
            }
            imageRect.right < viewWidth -> {
                // å³è¾¹æœ‰ç©ºéš™ï¼Œå¾€å³æ¨
                dx = viewWidth - imageRect.right
            }
        }

        // å‚ç›´æ–¹å‘çº¦æŸ
        when {
            imageRect.height() <= viewHeight -> {
                // å›¾ç‰‡é«˜åº¦å°äº Viewï¼Œå±…ä¸­
                dy = (viewHeight - imageRect.height()) / 2f - imageRect.top
            }
            imageRect.top > 0 -> {
                // ä¸Šè¾¹æœ‰ç©ºéš™ï¼Œå¾€ä¸Šæ¨
                dy = -imageRect.top
            }
            imageRect.bottom < viewHeight -> {
                // ä¸‹è¾¹æœ‰ç©ºéš™ï¼Œå¾€ä¸‹æ¨
                dy = viewHeight - imageRect.bottom
            }
        }

        if (dx != 0f || dy != 0f) {
            imageMatrix.postTranslate(dx, dy)
        }
    }

    /**
     * é€šçŸ¥ç›‘å¬å™¨çŸ©é˜µå·²å˜åŒ–
     */
    private fun notifyMatrixChanged() {
        onMatrixChangeListener?.onMatrixChanged(this)
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç›‘å¬å™¨æ¥å£
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * çŸ©é˜µå˜åŒ–ç›‘å¬å™¨
     */
    interface OnMatrixChangeListener {
        fun onMatrixChanged(view: CropImageView)
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/CropOverlayView.kt">
package com.example.websnap

import android.annotation.SuppressLint
import android.content.Context
import android.graphics.Canvas
import android.graphics.Color
import android.graphics.Paint
import android.graphics.Path
import android.graphics.RectF
import android.util.AttributeSet
import android.view.MotionEvent
import android.view.View
import kotlin.math.abs

/**
 * è£å‰ªæ¡†è¦†ç›–å±‚
 *
 * åŠŸèƒ½ï¼š
 * - ç»˜åˆ¶å¯æ‹–åŠ¨çš„è£å‰ªæ¡†
 * - å››æ¡è¾¹ç‹¬ç«‹æ‹–åŠ¨
 * - å››ä¸ªè§’åŒæ—¶æ‹–åŠ¨ä¸¤æ¡è¾¹
 * - è£å‰ªæ¡†å¤–æ˜¾ç¤ºåŠé€æ˜é®ç½©
 * - ä¹å®«æ ¼è¾…åŠ©çº¿
 */
class CropOverlayView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = 0
) : View(context, attrs, defStyleAttr) {

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¸¸é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    companion object {
        /** è¾¹ç¼˜è§¦æ‘¸çƒ­åŒºå®½åº¦ (dp) */
        private const val TOUCH_THRESHOLD_DP = 40f

        /** è§’è½è§¦æ‘¸çƒ­åŒº (dp) */
        private const val CORNER_THRESHOLD_DP = 50f

        /** æœ€å°è£å‰ªå°ºå¯¸ (px) */
        private const val MIN_CROP_SIZE = 50f

        /** è¾¹æ¡†çº¿å®½åº¦ (dp) */
        private const val BORDER_WIDTH_DP = 2f

        /** è§’æ‰‹æŸ„é•¿åº¦ (dp) */
        private const val CORNER_LENGTH_DP = 28f

        /** è§’æ‰‹æŸ„å®½åº¦ (dp) - åŠ ç²— */
        private const val CORNER_WIDTH_DP = 6f
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ‹–åŠ¨æ¨¡å¼
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private enum class DragMode {
        NONE,
        LEFT,
        TOP,
        RIGHT,
        BOTTOM,
        TOP_LEFT,
        TOP_RIGHT,
        BOTTOM_LEFT,
        BOTTOM_RIGHT
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å°ºå¯¸ï¼ˆåƒç´ ï¼‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private val touchThreshold: Float
    private val cornerThreshold: Float
    private val borderWidth: Float
    private val cornerLength: Float
    private val cornerWidth: Float

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // çŠ¶æ€å˜é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /** è£å‰ªæ¡†çŸ©å½¢ï¼ˆView åæ ‡ç³»ï¼‰ */
    private val cropRect = RectF()

    /** å›¾ç‰‡è¾¹ç•Œï¼ˆView åæ ‡ç³»ï¼‰ */
    private var imageBounds = RectF()

    /** å½“å‰æ‹–åŠ¨æ¨¡å¼ */
    private var currentDragMode = DragMode.NONE

    /** ä¸Šæ¬¡è§¦æ‘¸ä½ç½® */
    private var lastTouchX = 0f
    private var lastTouchY = 0f

    /** å…³è”çš„ CropImageView */
    private var cropImageView: CropImageView? = null

    /** è£å‰ªæ¡†å˜åŒ–ç›‘å¬å™¨ */
    private var onCropRectChangeListener: OnCropRectChangeListener? = null

    /** ç”¨äºç»˜åˆ¶ L å‹è§’æ‰‹æŸ„çš„ Path */
    private val cornerPath = Path()

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç”»ç¬”
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /** é®ç½©ç”»ç¬” */
    private val overlayPaint = Paint().apply {
        color = Color.parseColor("#80000000")
        style = Paint.Style.FILL
    }

    /** è¾¹æ¡†ç”»ç¬”ï¼ˆç»¿è‰²çº¿ï¼‰ */
    private val borderPaint = Paint().apply {
        color = Color.GREEN
        style = Paint.Style.STROKE
        isAntiAlias = true
    }

    /** è§’æ‰‹æŸ„ç”»ç¬”ï¼ˆçº¢è‰²åŠ ç²—ï¼Œåœ†æ¶¦è½¬è§’ï¼‰ */
    private val cornerPaint = Paint().apply {
        color = Color.parseColor("#FF0000")
        style = Paint.Style.STROKE
        isAntiAlias = true
        strokeCap = Paint.Cap.ROUND
        strokeJoin = Paint.Join.ROUND
    }

    /** ç½‘æ ¼çº¿ç”»ç¬”ï¼ˆåŠé€æ˜è“è‰²ï¼Œä¸ä¸»é¢˜è‰²ä¸€è‡´ï¼‰ */
    private val gridPaint = Paint().apply {
        color = Color.parseColor("#801976D2")
        style = Paint.Style.STROKE
        isAntiAlias = true
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // åˆå§‹åŒ–
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    init {
        val density = context.resources.displayMetrics.density
        touchThreshold = TOUCH_THRESHOLD_DP * density
        cornerThreshold = CORNER_THRESHOLD_DP * density
        borderWidth = BORDER_WIDTH_DP * density
        cornerLength = CORNER_LENGTH_DP * density
        cornerWidth = CORNER_WIDTH_DP * density

        borderPaint.strokeWidth = borderWidth
        cornerPaint.strokeWidth = cornerWidth
        gridPaint.strokeWidth = 1f * density
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å…¬å¼€ API
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * è®¾ç½®å…³è”çš„ CropImageView
     */
    fun setCropImageView(imageView: CropImageView) {
        this.cropImageView = imageView
        imageView.setOnMatrixChangeListener(object : CropImageView.OnMatrixChangeListener {
            override fun onMatrixChanged(view: CropImageView) {
                updateImageBounds()
                invalidate()
            }
        })
    }

    /**
     * æ›´æ–°å›¾ç‰‡è¾¹ç•Œå¹¶åˆå§‹åŒ–è£å‰ªæ¡†
     */
    fun updateImageBounds() {
        val imageView = cropImageView ?: return
        imageBounds = imageView.getImageBounds()

        // å¦‚æœè£å‰ªæ¡†æœªåˆå§‹åŒ–æˆ–è¶…å‡ºå›¾ç‰‡è¾¹ç•Œï¼Œé‡ç½®ä¸ºå…¨å›¾
        if (cropRect.isEmpty || !imageBounds.contains(cropRect)) {
            resetCropRect()
        }
    }

    /**
     * é‡ç½®è£å‰ªæ¡†ä¸ºå…¨å›¾
     */
    fun resetCropRect() {
        cropRect.set(imageBounds)
        invalidate()
        notifyCropRectChanged()
    }

    /**
     * è·å–è£å‰ªæ¡†ï¼ˆBitmap åƒç´ åæ ‡ï¼‰
     */
    fun getCropRectInBitmap(): RectF {
        val imageView = cropImageView ?: return RectF()

        val topLeft = imageView.viewToBitmapCoord(cropRect.left, cropRect.top)
        val bottomRight = imageView.viewToBitmapCoord(cropRect.right, cropRect.bottom)

        return RectF(
            topLeft[0],
            topLeft[1],
            bottomRight[0],
            bottomRight[1]
        )
    }

    /**
     * è®¾ç½®è£å‰ªæ¡†å˜åŒ–ç›‘å¬å™¨
     */
    fun setOnCropRectChangeListener(listener: OnCropRectChangeListener?) {
        this.onCropRectChangeListener = listener
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç»˜åˆ¶
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    override fun onDraw(canvas: Canvas) {
        super.onDraw(canvas)

        if (cropRect.isEmpty) return

        // 1. ç»˜åˆ¶åŠé€æ˜é®ç½©
        drawOverlay(canvas)

        // 2. ç»˜åˆ¶ç½‘æ ¼çº¿
        drawGrid(canvas)

        // 3. ç»˜åˆ¶ç™½è‰²è¾¹æ¡†ï¼ˆå…ˆç»˜åˆ¶ï¼Œåœ¨ä¸‹å±‚ï¼‰
        canvas.drawRect(cropRect, borderPaint)

        // 4. ç»˜åˆ¶çº¢è‰²è§’æ‰‹æŸ„ï¼ˆåç»˜åˆ¶ï¼Œç›–ä½ç™½è‰²è¾¹æ¡†é¡¶ç‚¹ï¼‰
        drawCorners(canvas)
    }

    private fun drawOverlay(canvas: Canvas) {
        val w = width.toFloat()
        val h = height.toFloat()

        // ä¸Šæ–¹é®ç½©
        canvas.drawRect(0f, 0f, w, cropRect.top, overlayPaint)
        // ä¸‹æ–¹é®ç½©
        canvas.drawRect(0f, cropRect.bottom, w, h, overlayPaint)
        // å·¦ä¾§é®ç½©
        canvas.drawRect(0f, cropRect.top, cropRect.left, cropRect.bottom, overlayPaint)
        // å³ä¾§é®ç½©
        canvas.drawRect(cropRect.right, cropRect.top, w, cropRect.bottom, overlayPaint)
    }

    private fun drawGrid(canvas: Canvas) {
        val thirdWidth = cropRect.width() / 3f
        val thirdHeight = cropRect.height() / 3f

        // å‚ç›´çº¿
        canvas.drawLine(
            cropRect.left + thirdWidth, cropRect.top,
            cropRect.left + thirdWidth, cropRect.bottom,
            gridPaint
        )
        canvas.drawLine(
            cropRect.left + thirdWidth * 2, cropRect.top,
            cropRect.left + thirdWidth * 2, cropRect.bottom,
            gridPaint
        )

        // æ°´å¹³çº¿
        canvas.drawLine(
            cropRect.left, cropRect.top + thirdHeight,
            cropRect.right, cropRect.top + thirdHeight,
            gridPaint
        )
        canvas.drawLine(
            cropRect.left, cropRect.top + thirdHeight * 2,
            cropRect.right, cropRect.top + thirdHeight * 2,
            gridPaint
        )
    }

    /**
     * ç»˜åˆ¶å››ä¸ªè§’çš„ L å‹æ‰‹æŸ„
     * ä½¿ç”¨ Path ç»˜åˆ¶è¿ç»­è·¯å¾„ï¼Œç¡®ä¿è½¬è§’åœ†æ¶¦ä¸”ç²¾å‡†å¯¹é½
     */
    private fun drawCorners(canvas: Canvas) {
        cornerPath.reset()

        // å·¦ä¸Šè§’ L å‹ï¼šä»ä¸‹å¾€ä¸Šï¼Œå†å¾€å³
        cornerPath.moveTo(cropRect.left, cropRect.top + cornerLength)
        cornerPath.lineTo(cropRect.left, cropRect.top)
        cornerPath.lineTo(cropRect.left + cornerLength, cropRect.top)

        // å³ä¸Šè§’ L å‹ï¼šä»å·¦å¾€å³ï¼Œå†å¾€ä¸‹
        cornerPath.moveTo(cropRect.right - cornerLength, cropRect.top)
        cornerPath.lineTo(cropRect.right, cropRect.top)
        cornerPath.lineTo(cropRect.right, cropRect.top + cornerLength)

        // å·¦ä¸‹è§’ L å‹ï¼šä»ä¸Šå¾€ä¸‹ï¼Œå†å¾€å³
        cornerPath.moveTo(cropRect.left, cropRect.bottom - cornerLength)
        cornerPath.lineTo(cropRect.left, cropRect.bottom)
        cornerPath.lineTo(cropRect.left + cornerLength, cropRect.bottom)

        // å³ä¸‹è§’ L å‹ï¼šä»å·¦å¾€å³ï¼Œå†å¾€ä¸Š
        cornerPath.moveTo(cropRect.right - cornerLength, cropRect.bottom)
        cornerPath.lineTo(cropRect.right, cropRect.bottom)
        cornerPath.lineTo(cropRect.right, cropRect.bottom - cornerLength)

        canvas.drawPath(cornerPath, cornerPaint)
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // è§¦æ‘¸äº‹ä»¶
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @SuppressLint("ClickableViewAccessibility")
    override fun onTouchEvent(event: MotionEvent): Boolean {
        val x = event.x
        val y = event.y

        when (event.action) {
            MotionEvent.ACTION_DOWN -> {
                currentDragMode = detectDragMode(x, y)
                lastTouchX = x
                lastTouchY = y
                return currentDragMode != DragMode.NONE
            }

            MotionEvent.ACTION_MOVE -> {
                if (currentDragMode != DragMode.NONE) {
                    val dx = x - lastTouchX
                    val dy = y - lastTouchY

                    updateCropRect(dx, dy)

                    lastTouchX = x
                    lastTouchY = y
                    invalidate()
                    notifyCropRectChanged()
                    return true
                }
            }

            MotionEvent.ACTION_UP, MotionEvent.ACTION_CANCEL -> {
                currentDragMode = DragMode.NONE
            }
        }

        return super.onTouchEvent(event)
    }

    private fun detectDragMode(x: Float, y: Float): DragMode {
        // æ£€æµ‹å››ä¸ªè§’ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
        val nearLeft = abs(x - cropRect.left) < cornerThreshold
        val nearRight = abs(x - cropRect.right) < cornerThreshold
        val nearTop = abs(y - cropRect.top) < cornerThreshold
        val nearBottom = abs(y - cropRect.bottom) < cornerThreshold

        if (nearLeft && nearTop) return DragMode.TOP_LEFT
        if (nearRight && nearTop) return DragMode.TOP_RIGHT
        if (nearLeft && nearBottom) return DragMode.BOTTOM_LEFT
        if (nearRight && nearBottom) return DragMode.BOTTOM_RIGHT

        // æ£€æµ‹å››æ¡è¾¹
        val inVerticalRange = y > cropRect.top - touchThreshold &&
                y < cropRect.bottom + touchThreshold
        val inHorizontalRange = x > cropRect.left - touchThreshold &&
                x < cropRect.right + touchThreshold

        if (abs(x - cropRect.left) < touchThreshold && inVerticalRange) {
            return DragMode.LEFT
        }
        if (abs(x - cropRect.right) < touchThreshold && inVerticalRange) {
            return DragMode.RIGHT
        }
        if (abs(y - cropRect.top) < touchThreshold && inHorizontalRange) {
            return DragMode.TOP
        }
        if (abs(y - cropRect.bottom) < touchThreshold && inHorizontalRange) {
            return DragMode.BOTTOM
        }

        return DragMode.NONE
    }

    private fun updateCropRect(dx: Float, dy: Float) {
        when (currentDragMode) {
            DragMode.LEFT -> {
                cropRect.left = constrainLeft(cropRect.left + dx)
            }
            DragMode.RIGHT -> {
                cropRect.right = constrainRight(cropRect.right + dx)
            }
            DragMode.TOP -> {
                cropRect.top = constrainTop(cropRect.top + dy)
            }
            DragMode.BOTTOM -> {
                cropRect.bottom = constrainBottom(cropRect.bottom + dy)
            }
            DragMode.TOP_LEFT -> {
                cropRect.left = constrainLeft(cropRect.left + dx)
                cropRect.top = constrainTop(cropRect.top + dy)
            }
            DragMode.TOP_RIGHT -> {
                cropRect.right = constrainRight(cropRect.right + dx)
                cropRect.top = constrainTop(cropRect.top + dy)
            }
            DragMode.BOTTOM_LEFT -> {
                cropRect.left = constrainLeft(cropRect.left + dx)
                cropRect.bottom = constrainBottom(cropRect.bottom + dy)
            }
            DragMode.BOTTOM_RIGHT -> {
                cropRect.right = constrainRight(cropRect.right + dx)
                cropRect.bottom = constrainBottom(cropRect.bottom + dy)
            }
            DragMode.NONE -> {}
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // è¾¹ç•Œçº¦æŸ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun constrainLeft(value: Float): Float {
        val minLeft = imageBounds.left
        val maxLeft = cropRect.right - MIN_CROP_SIZE
        return value.coerceIn(minLeft, maxLeft)
    }

    private fun constrainRight(value: Float): Float {
        val minRight = cropRect.left + MIN_CROP_SIZE
        val maxRight = imageBounds.right
        return value.coerceIn(minRight, maxRight)
    }

    private fun constrainTop(value: Float): Float {
        val minTop = imageBounds.top
        val maxTop = cropRect.bottom - MIN_CROP_SIZE
        return value.coerceIn(minTop, maxTop)
    }

    private fun constrainBottom(value: Float): Float {
        val minBottom = cropRect.top + MIN_CROP_SIZE
        val maxBottom = imageBounds.bottom
        return value.coerceIn(minBottom, maxBottom)
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç›‘å¬å™¨
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun notifyCropRectChanged() {
        onCropRectChangeListener?.onCropRectChanged(cropRect)
    }

    /**
     * è£å‰ªæ¡†å˜åŒ–ç›‘å¬å™¨
     */
    interface OnCropRectChangeListener {
        fun onCropRectChanged(rect: RectF)
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/MainActivity.kt">
package com.example.websnap

import android.Manifest
import android.annotation.SuppressLint
import android.app.Activity
import android.app.AlertDialog
import android.app.TimePickerDialog
import android.content.ComponentName
import android.content.Context
import android.content.Intent
import android.content.ServiceConnection
import android.content.pm.PackageManager
import android.graphics.Bitmap
import android.graphics.Canvas
import android.net.Uri
import android.os.Build
import android.os.Bundle
import android.os.IBinder
import android.view.KeyEvent
import android.view.LayoutInflater
import android.view.View
import android.view.inputmethod.EditorInfo
import android.view.inputmethod.InputMethodManager
import android.webkit.CookieManager
import android.webkit.PermissionRequest
import android.webkit.ValueCallback
import android.webkit.WebChromeClient
import android.webkit.WebResourceError
import android.webkit.WebResourceRequest
import android.webkit.WebSettings
import android.webkit.WebView
import android.webkit.WebViewClient
import android.widget.ArrayAdapter
import android.widget.Button
import android.widget.EditText
import android.widget.Toast
import androidx.activity.result.ActivityResultLauncher
import androidx.activity.result.contract.ActivityResultContracts
import androidx.appcompat.app.AppCompatActivity
import androidx.core.app.ActivityCompat
import androidx.core.content.ContextCompat
import androidx.recyclerview.widget.LinearLayoutManager
import com.example.websnap.databinding.ActivityMainBinding
import com.example.websnap.databinding.BottomSheetBookmarksBinding
import com.example.websnap.databinding.BottomSheetRefreshBinding
import com.google.android.material.bottomsheet.BottomSheetDialog
import java.text.SimpleDateFormat
import java.util.Calendar
import java.util.Date
import java.util.Locale

class MainActivity : AppCompatActivity(), RefreshService.RefreshCallback {

    private lateinit var binding: ActivityMainBinding

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¸¸é‡é…ç½®
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private val homePageUrl = "file:///android_asset/home.html"
    private val maxCaptureHeight = 20000
    private val desktopViewportWidth = 1024

    private val desktopUserAgent =
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) " +
        "AppleWebKit/537.36 (KHTML, like Gecko) " +
        "Chrome/120.0.0.0 Safari/537.36"

    private val webViewSchemes = setOf("http", "https", "about", "data", "javascript", "file")
    private val systemSchemes = setOf("tel", "mailto", "sms")

    private val desktopModeScript: String
        get() = """
            (function() {
                var desktopWidth = $desktopViewportWidth;
                
                try {
                    Object.defineProperty(window, 'innerWidth', {
                        get: function() { return desktopWidth; },
                        configurable: true
                    });
                    Object.defineProperty(window, 'outerWidth', {
                        get: function() { return desktopWidth; },
                        configurable: true
                    });
                    Object.defineProperty(document.documentElement, 'clientWidth', {
                        get: function() { return desktopWidth; },
                        configurable: true
                    });
                    Object.defineProperty(screen, 'width', {
                        get: function() { return desktopWidth; },
                        configurable: true
                    });
                    Object.defineProperty(screen, 'availWidth', {
                        get: function() { return desktopWidth; },
                        configurable: true
                    });
                } catch(e) {}
                
                function setDesktopViewport() {
                    var viewport = document.querySelector('meta[name="viewport"]');
                    var content = 'width=' + desktopWidth + ', initial-scale=0.67, minimum-scale=0.1, maximum-scale=10';
                    
                    if (viewport) {
                        viewport.setAttribute('content', content);
                    } else if (document.head) {
                        viewport = document.createElement('meta');
                        viewport.name = 'viewport';
                        viewport.content = content;
                        document.head.insertBefore(viewport, document.head.firstChild);
                    }
                }
                
                setDesktopViewport();
                
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', setDesktopViewport);
                }
                
                try {
                    window.dispatchEvent(new Event('resize'));
                } catch(e) {}
            })();
        """.trimIndent()

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æƒé™è¯·æ±‚ç 
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    companion object {
        private const val PERMISSION_REQUEST_CAMERA = 1001
        private const val PERMISSION_REQUEST_MICROPHONE = 1002
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // çŠ¶æ€å˜é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private var isPageLoaded = false
    private var mobileUserAgent: String = ""
    private var isPcMode = false
    private var desktopModeAppliedForCurrentPage = false
    private var currentLoadingUrl: String? = null
    private var currentPageTitle: String = ""

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ–‡ä»¶ä¸Šä¼ ç›¸å…³
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private var fileUploadCallback: ValueCallback<Array<Uri>>? = null

    /**
     * æ–‡ä»¶é€‰æ‹©å™¨å¯åŠ¨å™¨
     * å¿…é¡»ä½œä¸ºç±»æˆå‘˜å˜é‡åœ¨ Activity åˆ›å»ºå‰æ³¨å†Œ
     */
    private val fileChooserLauncher: ActivityResultLauncher<Intent> =
        registerForActivityResult(ActivityResultContracts.StartActivityForResult()) { result ->
            handleFileChooserResult(result.resultCode, result.data)
        }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WebView æƒé™è¯·æ±‚ç›¸å…³
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private var pendingPermissionRequest: PermissionRequest? = null

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ä¹¦ç­¾ç›¸å…³
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private lateinit var bookmarkManager: BookmarkManager
    private var bookmarkBottomSheet: BottomSheetDialog? = null

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // åˆ·æ–°æœåŠ¡ç›¸å…³
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private var refreshService: RefreshService? = null
    private var isServiceBound = false
    private var refreshBottomSheet: BottomSheetDialog? = null

    private var selectedScheduledTime: Calendar? = null
    private var customIntervalSeconds: Long? = null

    private val serviceConnection = object : ServiceConnection {
        override fun onServiceConnected(name: ComponentName?, service: IBinder?) {
            val binder = service as RefreshService.RefreshBinder
            refreshService = binder.getService()
            refreshService?.setCallback(this@MainActivity)
            isServiceBound = true
            updateRefreshButtonState()
        }

        override fun onServiceDisconnected(name: ComponentName?) {
            refreshService?.setCallback(null)
            refreshService = null
            isServiceBound = false
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç”Ÿå‘½å‘¨æœŸ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        WebView.enableSlowWholeDocumentDraw()

        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        bookmarkManager = BookmarkManager.getInstance(this)

        setupWebView()
        setupListeners()
        updateNavigationButtons()
        updateBookmarkButton()
        updatePcModeButton()

        loadHomePage()
    }

    override fun onStart() {
        super.onStart()
        Intent(this, RefreshService::class.java).also { intent ->
            bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE)
        }
    }

    override fun onResume() {
        super.onResume()
        if (refreshService?.hasActiveTask() != true) {
            binding.webView.onResume()
            binding.webView.resumeTimers()
        }
        updateRefreshButtonState()
    }

    override fun onPause() {
        super.onPause()
        if (refreshService?.hasActiveTask() != true) {
            binding.webView.onPause()
            binding.webView.pauseTimers()
        }
    }

    override fun onDestroy() {
        fileUploadCallback?.onReceiveValue(null)
        fileUploadCallback = null

        if (isServiceBound) {
            refreshService?.setCallback(null)
            unbindService(serviceConnection)
            isServiceBound = false
        }

        bookmarkBottomSheet?.dismiss()
        refreshBottomSheet?.dismiss()

        binding.webView.apply {
            stopLoading()
            clearHistory()
            clearCache(true)
            loadUrl("about:blank")
            removeAllViews()
            destroy()
        }
        super.onDestroy()
    }

    @Deprecated("Deprecated in Java")
    override fun onBackPressed() {
        when {
            refreshBottomSheet?.isShowing == true -> {
                refreshBottomSheet?.dismiss()
            }
            bookmarkBottomSheet?.isShowing == true -> {
                bookmarkBottomSheet?.dismiss()
            }
            binding.webView.canGoBack() -> {
                binding.webView.goBack()
            }
            else -> {
                @Suppress("DEPRECATION")
                super.onBackPressed()
            }
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ–‡ä»¶ä¸Šä¼ å¤„ç†
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * å¤„ç†æ–‡ä»¶é€‰æ‹©ç»“æœ
     */
    private fun handleFileChooserResult(resultCode: Int, data: Intent?) {
        val callback = fileUploadCallback
        fileUploadCallback = null

        if (callback == null) {
            return
        }

        if (resultCode != Activity.RESULT_OK) {
            callback.onReceiveValue(null)
            return
        }

        val results: Array<Uri>? = when {
            data?.data != null -> {
                arrayOf(data.data!!)
            }
            data?.clipData != null -> {
                val clipData = data.clipData!!
                Array(clipData.itemCount) { i ->
                    clipData.getItemAt(i).uri
                }
            }
            else -> null
        }

        callback.onReceiveValue(results)
    }

    /**
     * å¯åŠ¨ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©å™¨
     * ä½¿ç”¨ ACTION_OPEN_DOCUMENT æ‰“å¼€å®Œæ•´çš„å­˜å‚¨è®¿é—®æ¡†æ¶(SAF)ç•Œé¢
     * è¿™æ ·å¯ä»¥è®¿é—®ï¼šå†…éƒ¨å­˜å‚¨ã€SDå¡ã€ä¸‹è½½æ–‡ä»¶å¤¹ã€æ–‡æ¡£ç­‰æ‰€æœ‰ä½ç½®
     */
    private fun launchSystemFilePicker(params: WebChromeClient.FileChooserParams?) {
        try {
            val allowMultiple = params?.mode == WebChromeClient.FileChooserParams.MODE_OPEN_MULTIPLE

            // ä½¿ç”¨ ACTION_OPEN_DOCUMENT è·å¾—å®Œæ•´çš„å­˜å‚¨è®¿é—®æ¡†æ¶(SAF)
            // è¿™ä¼šæ˜¾ç¤ºï¼šå†…éƒ¨å­˜å‚¨ã€SDå¡ã€ä¸‹è½½ã€æ–‡æ¡£ç­‰æ‰€æœ‰å…¥å£
            val documentIntent = Intent(Intent.ACTION_OPEN_DOCUMENT).apply {
                addCategory(Intent.CATEGORY_OPENABLE)
                // ä½¿ç”¨ */* æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ç±»å‹ï¼Œè®©ç½‘é¡µç«¯éªŒè¯
                type = "*/*"
                // å…è®¸å¤šé€‰
                putExtra(Intent.EXTRA_ALLOW_MULTIPLE, allowMultiple)
                // æˆäºˆè¯»å–æƒé™
                addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
            }

            // åŒæ—¶åˆ›å»º ACTION_GET_CONTENT ä½œä¸ºå¤‡é€‰
            val contentIntent = Intent(Intent.ACTION_GET_CONTENT).apply {
                addCategory(Intent.CATEGORY_OPENABLE)
                type = "*/*"
                putExtra(Intent.EXTRA_ALLOW_MULTIPLE, allowMultiple)
            }

            // ä½¿ç”¨ chooser ç»„åˆä¸¤ç§ Intentï¼Œè®©ç”¨æˆ·çœ‹åˆ°æœ€å®Œæ•´çš„é€‰é¡¹
            val chooserIntent = Intent.createChooser(contentIntent, null).apply {
                // å°† ACTION_OPEN_DOCUMENT ä½œä¸ºé¢å¤–é€‰é¡¹æ·»åŠ 
                putExtra(Intent.EXTRA_INITIAL_INTENTS, arrayOf(documentIntent))
            }

            fileChooserLauncher.launch(chooserIntent)

        } catch (e: Exception) {
            e.printStackTrace()
            fileUploadCallback?.onReceiveValue(null)
            fileUploadCallback = null
            showToast(getString(R.string.toast_file_picker_error))
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WebView é…ç½®
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @SuppressLint("SetJavaScriptEnabled")
    private fun setupWebView() {
        binding.webView.apply {
            mobileUserAgent = settings.userAgentString

            settings.apply {
                javaScriptEnabled = true
                domStorageEnabled = true
                databaseEnabled = true
                useWideViewPort = true
                loadWithOverviewMode = true
                setSupportZoom(true)
                builtInZoomControls = true
                displayZoomControls = false
                mixedContentMode = WebSettings.MIXED_CONTENT_ALWAYS_ALLOW
                cacheMode = WebSettings.LOAD_DEFAULT
                allowFileAccess = true
                userAgentString = userAgentString.replace("; wv", "")
                mediaPlaybackRequiresUserGesture = false
            }

            mobileUserAgent = settings.userAgentString
            webViewClient = createWebViewClient()
            webChromeClient = createWebChromeClient()
        }

        val cookieManager = CookieManager.getInstance()
        cookieManager.setAcceptCookie(true)
        cookieManager.setAcceptThirdPartyCookies(binding.webView, true)
    }

    private fun createWebViewClient(): WebViewClient {
        return object : WebViewClient() {

            override fun onPageStarted(view: WebView?, url: String?, favicon: Bitmap?) {
                super.onPageStarted(view, url, favicon)
                isPageLoaded = false
                binding.progressBar.visibility = View.VISIBLE
                binding.progressBar.progress = 0
                binding.buttonCapture.isEnabled = false

                if (url != currentLoadingUrl) {
                    currentLoadingUrl = url
                    desktopModeAppliedForCurrentPage = false
                }

                if (url != null && !url.startsWith("file:")) {
                    binding.editTextUrl.setText(url)
                    binding.editTextUrl.setSelection(url.length)
                } else if (url?.startsWith("file:") == true) {
                    binding.editTextUrl.setText("")
                }

                updateNavigationButtons()
                updateBookmarkButton()

                if (isPcMode && view != null && url?.startsWith("file:") != true) {
                    view.evaluateJavascript(desktopModeScript, null)
                }
            }

            override fun onPageFinished(view: WebView?, url: String?) {
                super.onPageFinished(view, url)
                isPageLoaded = true
                binding.progressBar.visibility = View.GONE
                binding.buttonCapture.isEnabled = true
                updateNavigationButtons()
                updateBookmarkButton()

                CookieManager.getInstance().flush()

                if (isPcMode && view != null && url?.startsWith("file:") != true) {
                    handleDesktopModePageFinished(view)
                }
            }

            override fun onReceivedError(
                view: WebView?,
                request: WebResourceRequest?,
                error: WebResourceError?
            ) {
                super.onReceivedError(view, request, error)
                if (request?.isForMainFrame == true) {
                    val errorMsg = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
                        error?.description?.toString() ?: "Unknown error"
                    } else {
                        "Load failed"
                    }
                    showToast(getString(R.string.error_page_message, errorMsg))
                }
            }

            override fun shouldOverrideUrlLoading(
                view: WebView?,
                request: WebResourceRequest?
            ): Boolean {
                val url = request?.url ?: return false
                val scheme = url.scheme?.lowercase() ?: return false

                desktopModeAppliedForCurrentPage = false

                return when {
                    scheme in webViewSchemes -> false
                    scheme in systemSchemes -> {
                        handleSystemScheme(url)
                        true
                    }
                    else -> true
                }
            }

            override fun doUpdateVisitedHistory(
                view: WebView?,
                url: String?,
                isReload: Boolean
            ) {
                super.doUpdateVisitedHistory(view, url, isReload)
                updateNavigationButtons()
                updateBookmarkButton()
            }
        }
    }

    private fun handleDesktopModePageFinished(view: WebView) {
        view.evaluateJavascript(desktopModeScript) { _ ->
            if (!desktopModeAppliedForCurrentPage) {
                desktopModeAppliedForCurrentPage = true

                view.postDelayed({
                    if (isPcMode && isPageLoaded) {
                        view.reload()
                    }
                }, 300)
            }
        }
    }

    private fun createWebChromeClient(): WebChromeClient {
        return object : WebChromeClient() {

            override fun onProgressChanged(view: WebView?, newProgress: Int) {
                super.onProgressChanged(view, newProgress)
                binding.progressBar.progress = newProgress
                if (newProgress >= 100) {
                    binding.progressBar.visibility = View.GONE
                }
            }

            override fun onReceivedTitle(view: WebView?, title: String?) {
                super.onReceivedTitle(view, title)
                currentPageTitle = title ?: ""
            }

            override fun onShowFileChooser(
                webView: WebView?,
                filePathCallback: ValueCallback<Array<Uri>>?,
                fileChooserParams: FileChooserParams?
            ): Boolean {
                fileUploadCallback?.onReceiveValue(null)
                fileUploadCallback = filePathCallback

                launchSystemFilePicker(fileChooserParams)

                return true
            }

            override fun onPermissionRequest(request: PermissionRequest?) {
                request?.let { permRequest ->
                    pendingPermissionRequest = permRequest

                    val requestedResources = permRequest.resources
                    val permissionsToRequest = mutableListOf<String>()

                    for (resource in requestedResources) {
                        when (resource) {
                            PermissionRequest.RESOURCE_VIDEO_CAPTURE -> {
                                if (!hasCameraPermission()) {
                                    permissionsToRequest.add(Manifest.permission.CAMERA)
                                }
                            }
                            PermissionRequest.RESOURCE_AUDIO_CAPTURE -> {
                                if (!hasMicrophonePermission()) {
                                    permissionsToRequest.add(Manifest.permission.RECORD_AUDIO)
                                }
                            }
                        }
                    }

                    if (permissionsToRequest.isEmpty()) {
                        permRequest.grant(requestedResources)
                        pendingPermissionRequest = null
                    } else {
                        ActivityCompat.requestPermissions(
                            this@MainActivity,
                            permissionsToRequest.toTypedArray(),
                            PERMISSION_REQUEST_CAMERA
                        )
                    }
                }
            }

            override fun onPermissionRequestCanceled(request: PermissionRequest?) {
                super.onPermissionRequestCanceled(request)
                pendingPermissionRequest = null
            }
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æƒé™æ£€æŸ¥ä¸è¯·æ±‚
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun hasCameraPermission(): Boolean {
        return ContextCompat.checkSelfPermission(
            this, Manifest.permission.CAMERA
        ) == PackageManager.PERMISSION_GRANTED
    }

    private fun hasMicrophonePermission(): Boolean {
        return ContextCompat.checkSelfPermission(
            this, Manifest.permission.RECORD_AUDIO
        ) == PackageManager.PERMISSION_GRANTED
    }

    override fun onRequestPermissionsResult(
        requestCode: Int,
        permissions: Array<out String>,
        grantResults: IntArray
    ) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults)

        when (requestCode) {
            PERMISSION_REQUEST_CAMERA, PERMISSION_REQUEST_MICROPHONE -> {
                pendingPermissionRequest?.let { request ->
                    val grantedResources = mutableListOf<String>()

                    for (resource in request.resources) {
                        when (resource) {
                            PermissionRequest.RESOURCE_VIDEO_CAPTURE -> {
                                if (hasCameraPermission()) {
                                    grantedResources.add(resource)
                                } else {
                                    showToast(getString(R.string.toast_permission_camera_denied))
                                }
                            }
                            PermissionRequest.RESOURCE_AUDIO_CAPTURE -> {
                                if (hasMicrophonePermission()) {
                                    grantedResources.add(resource)
                                } else {
                                    showToast(getString(R.string.toast_permission_mic_denied))
                                }
                            }
                        }
                    }

                    if (grantedResources.isNotEmpty()) {
                        request.grant(grantedResources.toTypedArray())
                    } else {
                        request.deny()
                    }
                    pendingPermissionRequest = null
                }
            }
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // äº‹ä»¶ç›‘å¬
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun setupListeners() {
        binding.buttonGo.setOnClickListener {
            loadUrl()
        }

        binding.editTextUrl.setOnEditorActionListener { _, actionId, event ->
            val isEnterKey = event?.keyCode == KeyEvent.KEYCODE_ENTER
                    && event.action == KeyEvent.ACTION_DOWN
            val isGoAction = actionId == EditorInfo.IME_ACTION_GO

            if (isEnterKey || isGoAction) {
                loadUrl()
                true
            } else {
                false
            }
        }

        binding.buttonBookmark.setOnClickListener {
            toggleBookmark()
        }

        binding.buttonBookmark.setOnLongClickListener {
            showBookmarkSheet()
            true
        }

        binding.buttonPcMode.setOnClickListener {
            togglePcMode()
        }

        binding.buttonBack.setOnClickListener {
            if (binding.webView.canGoBack()) {
                binding.webView.goBack()
            }
        }

        binding.buttonForward.setOnClickListener {
            if (binding.webView.canGoForward()) {
                binding.webView.goForward()
            }
        }

        binding.buttonHome.setOnClickListener {
            loadHomePage()
        }

        binding.buttonRefresh.setOnClickListener {
            performRefresh()
        }

        binding.buttonRefresh.setOnLongClickListener {
            showRefreshSheet()
            true
        }

        binding.buttonCapture.setOnClickListener {
            captureVisibleArea()
        }

        binding.buttonCapture.setOnLongClickListener {
            captureWholePage()
            true
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ä¸»é¡µåŠŸèƒ½
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun loadHomePage() {
        binding.editTextUrl.setText("")
        binding.webView.loadUrl(homePageUrl)
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¯¼èˆªåŠŸèƒ½
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun updateNavigationButtons() {
        binding.buttonBack.isEnabled = binding.webView.canGoBack()
        binding.buttonForward.isEnabled = binding.webView.canGoForward()
    }

    private fun handleSystemScheme(url: Uri) {
        try {
            val intent = Intent(Intent.ACTION_VIEW, url).apply {
                addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
            }
            startActivity(intent)
        } catch (e: Exception) {
            e.printStackTrace()
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ä¹¦ç­¾åŠŸèƒ½
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun updateBookmarkButton() {
        val currentUrl = binding.webView.url

        val isBookmarked = if (!currentUrl.isNullOrBlank()
            && currentUrl != "about:blank"
            && !currentUrl.startsWith("file:")) {
            bookmarkManager.contains(currentUrl)
        } else {
            false
        }

        binding.buttonBookmark.text = if (isBookmarked) {
            getString(R.string.button_bookmark_filled)
        } else {
            getString(R.string.button_bookmark_empty)
        }
    }

    private fun toggleBookmark() {
        val currentUrl = binding.webView.url

        if (currentUrl.isNullOrBlank()
            || currentUrl == "about:blank"
            || currentUrl.startsWith("file:")) {
            showToast(getString(R.string.toast_bookmark_need_page))
            return
        }

        if (bookmarkManager.contains(currentUrl)) {
            bookmarkManager.remove(currentUrl)
            showToast(getString(R.string.toast_bookmark_removed))
        } else {
            val title = currentPageTitle.ifBlank { currentUrl }
            val bookmark = Bookmark(title = title, url = currentUrl)
            bookmarkManager.add(bookmark)
            showToast(getString(R.string.toast_bookmark_added))
        }

        updateBookmarkButton()
    }

    private fun showBookmarkSheet() {
        val bottomSheet = BottomSheetDialog(this, R.style.Theme_WebSnap_BottomSheet)
        val sheetBinding = BottomSheetBookmarksBinding.inflate(layoutInflater)
        bottomSheet.setContentView(sheetBinding.root)

        val adapter = BookmarkAdapter(
            onItemClick = { bookmark ->
                bottomSheet.dismiss()
                binding.webView.loadUrl(bookmark.url)
            },
            onDeleteClick = { bookmark, position ->
                bookmarkManager.removeAt(position)
                (sheetBinding.recyclerViewBookmarks.adapter as? BookmarkAdapter)?.removeAt(position)
                showToast(getString(R.string.toast_bookmark_deleted, bookmark.title))

                if (bookmarkManager.isEmpty()) {
                    sheetBinding.recyclerViewBookmarks.visibility = View.GONE
                    sheetBinding.emptyStateContainer.visibility = View.VISIBLE
                }

                updateBookmarkButton()
            }
        )

        sheetBinding.recyclerViewBookmarks.apply {
            layoutManager = LinearLayoutManager(this@MainActivity)
            this.adapter = adapter
        }

        val bookmarks = bookmarkManager.getAll()
        if (bookmarks.isEmpty()) {
            sheetBinding.recyclerViewBookmarks.visibility = View.GONE
            sheetBinding.emptyStateContainer.visibility = View.VISIBLE
        } else {
            sheetBinding.recyclerViewBookmarks.visibility = View.VISIBLE
            sheetBinding.emptyStateContainer.visibility = View.GONE
            adapter.submitList(bookmarks)
        }

        bookmarkBottomSheet = bottomSheet
        bottomSheet.show()
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PC æ¨¡å¼
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun updatePcModeButton() {
        binding.buttonPcMode.isSelected = isPcMode
    }

    private fun togglePcMode() {
        isPcMode = !isPcMode
        updatePcModeButton()

        val webSettings = binding.webView.settings
        desktopModeAppliedForCurrentPage = false

        if (isPcMode) {
            webSettings.userAgentString = desktopUserAgent
            webSettings.useWideViewPort = true
            webSettings.loadWithOverviewMode = false
            showToast(getString(R.string.toast_pc_mode_on))
        } else {
            webSettings.userAgentString = mobileUserAgent
            webSettings.useWideViewPort = true
            webSettings.loadWithOverviewMode = true
            showToast(getString(R.string.toast_pc_mode_off))
        }

        val currentUrl = binding.webView.url
        if (!currentUrl.isNullOrBlank()
            && currentUrl != "about:blank"
            && !currentUrl.startsWith("file:")) {
            binding.webView.reload()
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // åˆ·æ–°åŠŸèƒ½
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun performRefresh() {
        val currentUrl = binding.webView.url

        if (currentUrl.isNullOrBlank() || currentUrl == "about:blank") {
            showToast(getString(R.string.toast_refresh_need_page))
            return
        }

        binding.webView.reload()
    }

    private fun updateRefreshButtonState() {
        val service = refreshService

        if (service != null && service.hasActiveTask()) {
            binding.buttonRefresh.isActivated = true

            val task = service.getCurrentTask()
            val remaining = service.getRemainingSeconds()

            when (task) {
                is RefreshTask.Interval -> {
                    binding.buttonRefresh.text = getString(
                        R.string.button_refresh_countdown,
                        formatSeconds(remaining)
                    )
                }
                is RefreshTask.Scheduled -> {
                    val timeFormat = SimpleDateFormat("HH:mm:ss", Locale.getDefault())
                    binding.buttonRefresh.text = getString(
                        R.string.button_refresh_scheduled,
                        timeFormat.format(Date(task.targetTimeMillis))
                    )
                }
                null -> {
                    binding.buttonRefresh.isActivated = false
                    binding.buttonRefresh.text = getString(R.string.button_refresh_default)
                }
            }
        } else {
            binding.buttonRefresh.isActivated = false
            binding.buttonRefresh.text = getString(R.string.button_refresh_default)
        }
    }

    private fun showRefreshSheet() {
        val bottomSheet = BottomSheetDialog(this, R.style.Theme_WebSnap_BottomSheet)
        val sheetBinding = BottomSheetRefreshBinding.inflate(layoutInflater)
        bottomSheet.setContentView(sheetBinding.root)

        val intervalOptions = resources.getStringArray(R.array.interval_options)
        val intervalValues = resources.getIntArray(R.array.interval_values)
        val spinnerAdapter = ArrayAdapter(
            this,
            android.R.layout.simple_spinner_item,
            intervalOptions
        ).apply {
            setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item)
        }
        sheetBinding.spinnerInterval.adapter = spinnerAdapter
        sheetBinding.spinnerInterval.setSelection(4)

        selectedScheduledTime = null
        customIntervalSeconds = null

        sheetBinding.buttonCustomInterval.setOnClickListener {
            showCustomIntervalDialog { seconds ->
                customIntervalSeconds = seconds
                sheetBinding.radioInterval.isChecked = true
                showToast("å·²è®¾ç½®è‡ªå®šä¹‰é—´éš”: ${getIntervalDisplayText(seconds)}")
            }
        }

        sheetBinding.buttonPickTime.setOnClickListener {
            showTimePicker(sheetBinding)
        }

        sheetBinding.radioInterval.setOnCheckedChangeListener { _, isChecked ->
            if (isChecked) {
                sheetBinding.radioScheduled.isChecked = false
                sheetBinding.containerInterval.alpha = 1f
                sheetBinding.buttonCustomInterval.alpha = 1f
                sheetBinding.containerScheduled.alpha = 0.5f
            }
        }

        sheetBinding.radioScheduled.setOnCheckedChangeListener { _, isChecked ->
            if (isChecked) {
                sheetBinding.radioInterval.isChecked = false
                sheetBinding.containerInterval.alpha = 0.5f
                sheetBinding.buttonCustomInterval.alpha = 0.5f
                sheetBinding.containerScheduled.alpha = 1f
                customIntervalSeconds = null
            }
        }

        sheetBinding.radioInterval.isChecked = true

        val service = refreshService
        if (service != null && service.hasActiveTask()) {
            sheetBinding.containerCurrentTask.visibility = View.VISIBLE
            sheetBinding.buttonCancelTask.visibility = View.VISIBLE

            val task = service.getCurrentTask()
            val remaining = service.getRemainingSeconds()

            when (task) {
                is RefreshTask.Interval -> {
                    val intervalText = getIntervalDisplayText(task.intervalSeconds)
                    sheetBinding.textViewCurrentTask.text = getString(
                        R.string.refresh_current_task_interval,
                        intervalText,
                        formatSeconds(remaining)
                    )
                }
                is RefreshTask.Scheduled -> {
                    val timeFormat = SimpleDateFormat("HH:mm:ss", Locale.getDefault())
                    sheetBinding.textViewCurrentTask.text = getString(
                        R.string.refresh_current_task_scheduled,
                        timeFormat.format(Date(task.targetTimeMillis))
                    )
                }
                null -> {
                    sheetBinding.containerCurrentTask.visibility = View.GONE
                    sheetBinding.buttonCancelTask.visibility = View.GONE
                }
            }
        } else {
            sheetBinding.containerCurrentTask.visibility = View.GONE
            sheetBinding.buttonCancelTask.visibility = View.GONE
        }

        sheetBinding.buttonCancelTask.setOnClickListener {
            refreshService?.stopTask()
            stopRefreshService()
            showToast(getString(R.string.toast_refresh_cancelled))
            bottomSheet.dismiss()
        }

        sheetBinding.buttonConfirm.setOnClickListener {
            when {
                sheetBinding.radioInterval.isChecked -> {
                    val seconds = customIntervalSeconds
                        ?: intervalValues[sheetBinding.spinnerInterval.selectedItemPosition].toLong()

                    if (seconds <= 0) {
                        showToast(getString(R.string.toast_invalid_interval))
                        return@setOnClickListener
                    }

                    startIntervalRefresh(seconds)
                    showToast(getString(R.string.toast_refresh_started))
                    bottomSheet.dismiss()
                }
                sheetBinding.radioScheduled.isChecked -> {
                    val time = selectedScheduledTime
                    if (time == null) {
                        showToast(getString(R.string.toast_refresh_select_time))
                    } else {
                        startScheduledRefresh(time.timeInMillis)
                        showToast(getString(R.string.toast_refresh_started))
                        bottomSheet.dismiss()
                    }
                }
                else -> {
                    showToast(getString(R.string.toast_refresh_select_mode))
                }
            }
        }

        refreshBottomSheet = bottomSheet
        bottomSheet.show()
    }

    private fun showCustomIntervalDialog(onConfirm: (Long) -> Unit) {
        val dialogView = LayoutInflater.from(this)
            .inflate(R.layout.dialog_custom_interval, null)

        val editHours = dialogView.findViewById<EditText>(R.id.editTextHours)
        val editMinutes = dialogView.findViewById<EditText>(R.id.editTextMinutes)
        val editSeconds = dialogView.findViewById<EditText>(R.id.editTextSeconds)
        val buttonCancel = dialogView.findViewById<Button>(R.id.buttonCancel)
        val buttonOk = dialogView.findViewById<Button>(R.id.buttonOk)

        editHours.setText("0")
        editMinutes.setText("5")
        editSeconds.setText("0")

        val dialog = AlertDialog.Builder(this)
            .setView(dialogView)
            .setCancelable(true)
            .create()

        dialog.window?.setBackgroundDrawableResource(android.R.color.transparent)

        buttonCancel.setOnClickListener {
            dialog.dismiss()
        }

        buttonOk.setOnClickListener {
            val hours = editHours.text.toString().toIntOrNull() ?: 0
            val minutes = editMinutes.text.toString().toIntOrNull() ?: 0
            val seconds = editSeconds.text.toString().toIntOrNull() ?: 0

            val totalSeconds = (hours * 3600L) + (minutes * 60L) + seconds

            if (totalSeconds <= 0) {
                showToast(getString(R.string.toast_invalid_interval))
                return@setOnClickListener
            }

            onConfirm(totalSeconds)
            dialog.dismiss()
        }

        dialog.show()
    }

    private fun showTimePicker(sheetBinding: BottomSheetRefreshBinding) {
        val calendar = Calendar.getInstance()
        val hour = calendar.get(Calendar.HOUR_OF_DAY)
        val minute = calendar.get(Calendar.MINUTE)

        TimePickerDialog(
            this,
            R.style.Theme_WebSnap_TimePicker,
            { _, selectedHour, selectedMinute ->
                showSecondPicker(sheetBinding, selectedHour, selectedMinute)
            },
            hour,
            minute,
            true
        ).show()
    }

    private fun showSecondPicker(
        sheetBinding: BottomSheetRefreshBinding,
        hour: Int,
        minute: Int
    ) {
        val seconds = arrayOf("00", "15", "30", "45")
        val secondValues = intArrayOf(0, 15, 30, 45)

        AlertDialog.Builder(this, R.style.Theme_WebSnap_SecondPicker)
            .setTitle("é€‰æ‹©ç§’æ•°")
            .setItems(seconds) { _, which ->
                val second = secondValues[which]

                val calendar = Calendar.getInstance().apply {
                    set(Calendar.HOUR_OF_DAY, hour)
                    set(Calendar.MINUTE, minute)
                    set(Calendar.SECOND, second)
                    set(Calendar.MILLISECOND, 0)
                }

                selectedScheduledTime = calendar

                val timeStr = String.format(
                    Locale.getDefault(),
                    "%02d:%02d:%02d",
                    hour, minute, second
                )
                sheetBinding.buttonPickTime.text = timeStr
            }
            .show()
    }

    private fun startIntervalRefresh(intervalSeconds: Long) {
        val intent = Intent(this, RefreshService::class.java).apply {
            action = RefreshService.ACTION_START_TASK
            putExtra(RefreshService.EXTRA_TASK_TYPE, "interval")
            putExtra(RefreshService.EXTRA_INTERVAL_SECONDS, intervalSeconds)
        }

        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            startForegroundService(intent)
        } else {
            startService(intent)
        }
    }

    private fun startScheduledRefresh(targetTimeMillis: Long) {
        val intent = Intent(this, RefreshService::class.java).apply {
            action = RefreshService.ACTION_START_TASK
            putExtra(RefreshService.EXTRA_TASK_TYPE, "scheduled")
            putExtra(RefreshService.EXTRA_TARGET_TIME, targetTimeMillis)
        }

        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            startForegroundService(intent)
        } else {
            startService(intent)
        }
    }

    private fun stopRefreshService() {
        val intent = Intent(this, RefreshService::class.java).apply {
            action = RefreshService.ACTION_STOP_TASK
        }
        startService(intent)
        updateRefreshButtonState()
    }

    private fun getIntervalDisplayText(seconds: Long): String {
        val hours = seconds / 3600
        val minutes = (seconds % 3600) / 60
        val secs = seconds % 60

        return when {
            hours > 0 && minutes > 0 && secs > 0 -> "${hours}æ—¶${minutes}åˆ†${secs}ç§’"
            hours > 0 && minutes > 0 -> "${hours}æ—¶${minutes}åˆ†"
            hours > 0 && secs > 0 -> "${hours}æ—¶${secs}ç§’"
            hours > 0 -> "${hours}å°æ—¶"
            minutes > 0 && secs > 0 -> "${minutes}åˆ†${secs}ç§’"
            minutes > 0 -> "${minutes}åˆ†é’Ÿ"
            else -> "${secs}ç§’"
        }
    }

    private fun formatSeconds(totalSeconds: Long): String {
        val hours = totalSeconds / 3600
        val minutes = (totalSeconds % 3600) / 60
        val seconds = totalSeconds % 60

        return if (hours > 0) {
            String.format(Locale.getDefault(), "%02d:%02d:%02d", hours, minutes, seconds)
        } else {
            String.format(Locale.getDefault(), "%02d:%02d", minutes, seconds)
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RefreshService.RefreshCallback å®ç°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    override fun onTaskStarted(task: RefreshTask) {
        runOnUiThread {
            updateRefreshButtonState()
        }
    }

    override fun onCountdownTick(remainingSeconds: Long) {
        runOnUiThread {
            val task = refreshService?.getCurrentTask()
            when (task) {
                is RefreshTask.Interval -> {
                    binding.buttonRefresh.text = getString(
                        R.string.button_refresh_countdown,
                        formatSeconds(remainingSeconds)
                    )
                }
                is RefreshTask.Scheduled -> {}
                null -> {}
            }
        }
    }

    override fun onRefreshTriggered() {
        runOnUiThread {
            binding.buttonRefresh.text = getString(R.string.button_refreshing)
            binding.webView.reload()
        }
    }

    override fun onTaskCancelled() {
        runOnUiThread {
            binding.buttonRefresh.isActivated = false
            binding.buttonRefresh.text = getString(R.string.button_refresh_default)
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // URL åŠ è½½
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun loadUrl() {
        val inputUrl = binding.editTextUrl.text.toString().trim()

        if (inputUrl.isEmpty()) {
            showToast(getString(R.string.toast_url_empty))
            return
        }

        val url = when {
            inputUrl.startsWith("http://") || inputUrl.startsWith("https://") -> inputUrl
            inputUrl.startsWith("www.") -> "https://$inputUrl"
            else -> "https://$inputUrl"
        }

        hideKeyboard()
        desktopModeAppliedForCurrentPage = false
        binding.webView.loadUrl(url)
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æˆªå›¾åŠŸèƒ½
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun captureVisibleArea() {
        if (!isPageLoaded) {
            showToast(getString(R.string.toast_page_not_loaded))
            return
        }

        binding.buttonCapture.isEnabled = false

        binding.webView.post {
            try {
                val bitmap = captureVisibleBitmap()

                if (bitmap != null) {
                    CropBitmapHolder.set(bitmap, isFullPage = false)
                    showToast(getString(R.string.toast_capture_visible))
                    startActivity(Intent(this, CropActivity::class.java))
                } else {
                    showToast(getString(R.string.toast_capture_failed))
                }

            } catch (e: OutOfMemoryError) {
                showToast(getString(R.string.toast_memory_insufficient))
                System.gc()

            } catch (e: Exception) {
                showToast(getString(R.string.toast_capture_failed))
                e.printStackTrace()

            } finally {
                binding.buttonCapture.isEnabled = true
            }
        }
    }

    private fun captureWholePage() {
        if (!isPageLoaded) {
            showToast(getString(R.string.toast_page_not_loaded))
            return
        }

        binding.buttonCapture.isEnabled = false

        binding.webView.post {
            try {
                val bitmap = captureFullPageBitmap()

                if (bitmap != null) {
                    CropBitmapHolder.set(bitmap, isFullPage = true)
                    showToast(getString(R.string.toast_capture_fullpage))
                    startActivity(Intent(this, CropActivity::class.java))
                } else {
                    showToast(getString(R.string.toast_capture_failed))
                }

            } catch (e: OutOfMemoryError) {
                showToast(getString(R.string.toast_memory_insufficient))
                System.gc()

            } catch (e: Exception) {
                showToast(getString(R.string.toast_capture_failed))
                e.printStackTrace()

            } finally {
                binding.buttonCapture.isEnabled = true
            }
        }
    }

    private fun captureVisibleBitmap(): Bitmap? {
        val webView = binding.webView

        val width = webView.width
        val height = webView.height

        if (width <= 0 || height <= 0) {
            return null
        }

        val bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888)
        val canvas = Canvas(bitmap)
        webView.draw(canvas)

        return bitmap
    }

    private fun captureFullPageBitmap(): Bitmap? {
        val webView = binding.webView

        @Suppress("DEPRECATION")
        val scale = webView.scale
        val contentWidth = webView.width
        var contentHeight = (webView.contentHeight * scale).toInt()

        if (contentWidth <= 0 || contentHeight <= 0) {
            return null
        }

        var wasTruncated = false
        if (contentHeight > maxCaptureHeight) {
            contentHeight = maxCaptureHeight
            wasTruncated = true
        }

        val requiredMemory = contentWidth.toLong() * contentHeight.toLong() * 4L
        val runtime = Runtime.getRuntime()
        val freeMemory = runtime.maxMemory() - runtime.totalMemory() + runtime.freeMemory()

        if (requiredMemory > freeMemory * 0.8) {
            showToast(getString(R.string.toast_memory_insufficient))
            return null
        }

        val originalLayerType = webView.layerType
        webView.setLayerType(View.LAYER_TYPE_SOFTWARE, null)

        val bitmap: Bitmap?
        try {
            bitmap = Bitmap.createBitmap(
                contentWidth,
                contentHeight,
                Bitmap.Config.ARGB_8888
            )

            val canvas = Canvas(bitmap)
            webView.draw(canvas)

        } finally {
            webView.setLayerType(originalLayerType, null)
        }

        if (wasTruncated) {
            showToast(getString(R.string.toast_page_too_long, maxCaptureHeight))
        }

        return bitmap
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å·¥å…·æ–¹æ³•
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun hideKeyboard() {
        val imm = getSystemService(INPUT_METHOD_SERVICE) as InputMethodManager
        currentFocus?.let { view ->
            imm.hideSoftInputFromWindow(view.windowToken, 0)
        }
        binding.editTextUrl.clearFocus()
    }

    private fun showToast(message: String) {
        Toast.makeText(this, message, Toast.LENGTH_SHORT).show()
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/RefreshService.kt">
package com.example.websnap

import android.app.Notification
import android.app.NotificationChannel
import android.app.NotificationManager
import android.app.PendingIntent
import android.app.Service
import android.content.Context
import android.content.Intent
import android.os.Binder
import android.os.Build
import android.os.Handler
import android.os.IBinder
import android.os.Looper
import androidx.core.app.NotificationCompat
import java.text.SimpleDateFormat
import java.util.Date
import java.util.Locale

/**
 * å‰å°åˆ·æ–°æœåŠ¡
 *
 * è´Ÿè´£åœ¨åå°ç»´æŒå®šæ—¶ä»»åŠ¡ï¼Œç¡®ä¿ App åœ¨åå°æ—¶ä¹Ÿèƒ½å‡†æ—¶åˆ·æ–°ã€‚
 */
class RefreshService : Service() {

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¸¸é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    companion object {
        private const val NOTIFICATION_ID = 1001
        private const val CHANNEL_ID = "websnap_refresh_channel"
        private const val CHANNEL_NAME = "è‡ªåŠ¨åˆ·æ–°"

        // Action å®šä¹‰
        const val ACTION_START_TASK = "com.example.websnap.START_TASK"
        const val ACTION_STOP_TASK = "com.example.websnap.STOP_TASK"
        const val EXTRA_TASK_TYPE = "task_type"
        const val EXTRA_INTERVAL_SECONDS = "interval_seconds"
        const val EXTRA_TARGET_TIME = "target_time"
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Binder
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private val binder = RefreshBinder()

    inner class RefreshBinder : Binder() {
        fun getService(): RefreshService = this@RefreshService
    }

    override fun onBind(intent: Intent?): IBinder = binder

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // çŠ¶æ€å˜é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private val handler = Handler(Looper.getMainLooper())
    private var currentTask: RefreshTask? = null
    private var state: RefreshState = RefreshState.IDLE

    /** ä¸‹ä¸€æ¬¡åˆ·æ–°çš„æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ */
    private var nextRefreshTimeMillis: Long = 0

    /** å›è°ƒç›‘å¬å™¨ */
    private var listener: RefreshCallback? = null

    /** é€šçŸ¥ç®¡ç†å™¨ */
    private lateinit var notificationManager: NotificationManager

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç”Ÿå‘½å‘¨æœŸ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    override fun onCreate() {
        super.onCreate()
        notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
        createNotificationChannel()
    }

    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
        when (intent?.action) {
            ACTION_START_TASK -> {
                val taskType = intent.getStringExtra(EXTRA_TASK_TYPE)
                when (taskType) {
                    "interval" -> {
                        val seconds = intent.getLongExtra(EXTRA_INTERVAL_SECONDS, 60)
                        startIntervalTask(seconds)
                    }
                    "scheduled" -> {
                        val targetTime = intent.getLongExtra(EXTRA_TARGET_TIME, 0)
                        if (targetTime > 0) {
                            startScheduledTask(targetTime)
                        }
                    }
                }
            }
            ACTION_STOP_TASK -> {
                stopTask()
            }
        }

        // START_STICKY: æœåŠ¡è¢«æ€åå°è¯•é‡å¯
        return START_STICKY
    }

    override fun onDestroy() {
        stopTask()
        super.onDestroy()
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å…¬å¼€ API
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * è®¾ç½®å›è°ƒç›‘å¬å™¨
     */
    fun setCallback(callback: RefreshCallback?) {
        this.listener = callback
    }

    /**
     * è·å–å½“å‰ä»»åŠ¡
     */
    fun getCurrentTask(): RefreshTask? = currentTask

    /**
     * è·å–å½“å‰çŠ¶æ€
     */
    fun getState(): RefreshState = state

    /**
     * è·å–å‰©ä½™ç§’æ•°
     */
    fun getRemainingSeconds(): Long {
        if (nextRefreshTimeMillis <= 0) return 0
        val remaining = (nextRefreshTimeMillis - System.currentTimeMillis()) / 1000
        return maxOf(0, remaining)
    }

    /**
     * æ˜¯å¦æœ‰æ´»åŠ¨ä»»åŠ¡
     */
    fun hasActiveTask(): Boolean = currentTask != null && state == RefreshState.COUNTING

    /**
     * å¯åŠ¨é—´éš”åˆ·æ–°ä»»åŠ¡
     */
    fun startIntervalTask(intervalSeconds: Long) {
        stopTask()

        currentTask = RefreshTask.Interval(intervalSeconds)
        nextRefreshTimeMillis = System.currentTimeMillis() + (intervalSeconds * 1000)
        state = RefreshState.COUNTING

        // å¯åŠ¨å‰å°æœåŠ¡
        startForeground(NOTIFICATION_ID, createNotification())

        // å¼€å§‹å€’è®¡æ—¶
        startCountdown()

        listener?.onTaskStarted(currentTask!!)
    }

    /**
     * å¯åŠ¨å®šæ—¶åˆ·æ–°ä»»åŠ¡
     */
    fun startScheduledTask(targetTimeMillis: Long) {
        // å¦‚æœç›®æ ‡æ—¶é—´å·²è¿‡ï¼Œåˆ™è®¾ä¸ºæ˜å¤©åŒä¸€æ—¶é—´
        var adjustedTime = targetTimeMillis
        if (adjustedTime <= System.currentTimeMillis()) {
            adjustedTime += 24 * 60 * 60 * 1000 // +24å°æ—¶
        }

        stopTask()

        currentTask = RefreshTask.Scheduled(adjustedTime)
        nextRefreshTimeMillis = adjustedTime
        state = RefreshState.COUNTING

        startForeground(NOTIFICATION_ID, createNotification())
        startCountdown()

        listener?.onTaskStarted(currentTask!!)
    }

    /**
     * åœæ­¢å½“å‰ä»»åŠ¡
     */
    fun stopTask() {
        handler.removeCallbacksAndMessages(null)
        
        val hadTask = currentTask != null
        currentTask = null
        nextRefreshTimeMillis = 0
        state = RefreshState.IDLE

        stopForeground(STOP_FOREGROUND_REMOVE)

        if (hadTask) {
            listener?.onTaskCancelled()
        }
    }

    /**
     * æ‰‹åŠ¨è§¦å‘åˆ·æ–°ï¼ˆå•å‡»åˆ·æ–°æŒ‰é’®æ—¶ï¼‰
     */
    fun triggerManualRefresh() {
        listener?.onRefreshTriggered()
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å†…éƒ¨é€»è¾‘
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private val countdownRunnable = object : Runnable {
        override fun run() {
            if (currentTask == null) return

            val remaining = getRemainingSeconds()

            if (remaining <= 0) {
                // æ—¶é—´åˆ°ï¼Œæ‰§è¡Œåˆ·æ–°
                performRefresh()
            } else {
                // æ›´æ–°å€’è®¡æ—¶
                listener?.onCountdownTick(remaining)
                updateNotification()

                // æ¯ç§’æ›´æ–°ä¸€æ¬¡
                handler.postDelayed(this, 1000)
            }
        }
    }

    private fun startCountdown() {
        handler.removeCallbacks(countdownRunnable)
        handler.post(countdownRunnable)
    }

    private fun performRefresh() {
        state = RefreshState.REFRESHING
        listener?.onRefreshTriggered()

        // åˆ·æ–°åå¤„ç†
        handler.postDelayed({
            when (val task = currentTask) {
                is RefreshTask.Interval -> {
                    // é—´éš”åˆ·æ–°ï¼šé‡æ–°å¼€å§‹è®¡æ—¶
                    nextRefreshTimeMillis = System.currentTimeMillis() + (task.intervalSeconds * 1000)
                    state = RefreshState.COUNTING
                    startCountdown()
                }
                is RefreshTask.Scheduled -> {
                    // å®šæ—¶åˆ·æ–°ï¼šä»»åŠ¡å®Œæˆï¼Œè®¾ä¸ºæ˜å¤©åŒä¸€æ—¶é—´
                    nextRefreshTimeMillis = task.targetTimeMillis + (24 * 60 * 60 * 1000)
                    currentTask = RefreshTask.Scheduled(nextRefreshTimeMillis)
                    state = RefreshState.COUNTING
                    startCountdown()
                    listener?.onTaskStarted(currentTask!!)
                }
                null -> {
                    state = RefreshState.IDLE
                }
            }
        }, 1000)
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // é€šçŸ¥ç®¡ç†
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private fun createNotificationChannel() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            val channel = NotificationChannel(
                CHANNEL_ID,
                CHANNEL_NAME,
                NotificationManager.IMPORTANCE_LOW
            ).apply {
                description = "WebSnap è‡ªåŠ¨åˆ·æ–°å€’è®¡æ—¶"
                setShowBadge(false)
            }
            notificationManager.createNotificationChannel(channel)
        }
    }

    private fun createNotification(): Notification {
        // ç‚¹å‡»é€šçŸ¥è¿”å› App
        val pendingIntent = PendingIntent.getActivity(
            this,
            0,
            Intent(this, MainActivity::class.java).apply {
                flags = Intent.FLAG_ACTIVITY_SINGLE_TOP
            },
            PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_IMMUTABLE
        )

        // å–æ¶ˆä»»åŠ¡çš„ Action
        val cancelIntent = PendingIntent.getService(
            this,
            1,
            Intent(this, RefreshService::class.java).apply {
                action = ACTION_STOP_TASK
            },
            PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_IMMUTABLE
        )

        val contentText = when (val task = currentTask) {
            is RefreshTask.Interval -> {
                val remaining = getRemainingSeconds()
                "é—´éš”åˆ·æ–° | å€’è®¡æ—¶: ${formatSeconds(remaining)}"
            }
            is RefreshTask.Scheduled -> {
                val timeFormat = SimpleDateFormat("HH:mm:ss", Locale.getDefault())
                "å®šæ—¶åˆ·æ–° | ç›®æ ‡: ${timeFormat.format(Date(task.targetTimeMillis))}"
            }
            null -> "ç­‰å¾…ä¸­..."
        }

        return NotificationCompat.Builder(this, CHANNEL_ID)
            .setSmallIcon(android.R.drawable.ic_popup_sync)
            .setContentTitle("WebSnap è‡ªåŠ¨åˆ·æ–°")
            .setContentText(contentText)
            .setContentIntent(pendingIntent)
            .addAction(android.R.drawable.ic_delete, "å–æ¶ˆ", cancelIntent)
            .setOngoing(true)
            .setSilent(true)
            .setPriority(NotificationCompat.PRIORITY_LOW)
            .build()
    }

    private fun updateNotification() {
        if (currentTask != null) {
            notificationManager.notify(NOTIFICATION_ID, createNotification())
        }
    }

    private fun formatSeconds(totalSeconds: Long): String {
        val hours = totalSeconds / 3600
        val minutes = (totalSeconds % 3600) / 60
        val seconds = totalSeconds % 60

        return if (hours > 0) {
            String.format(Locale.getDefault(), "%02d:%02d:%02d", hours, minutes, seconds)
        } else {
            String.format(Locale.getDefault(), "%02d:%02d", minutes, seconds)
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å›è°ƒæ¥å£
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    interface RefreshCallback {
        /** ä»»åŠ¡å·²å¯åŠ¨ */
        fun onTaskStarted(task: RefreshTask)

        /** å€’è®¡æ—¶æ›´æ–°ï¼ˆæ¯ç§’è°ƒç”¨ï¼‰ */
        fun onCountdownTick(remainingSeconds: Long)

        /** éœ€è¦æ‰§è¡Œåˆ·æ–° */
        fun onRefreshTriggered()

        /** ä»»åŠ¡å·²å–æ¶ˆ */
        fun onTaskCancelled()
    }
}
</file>

<file path="app/src/main/java/com/example/websnap/RefreshTask.kt">
package com.example.websnap

import java.io.Serializable

/**
 * åˆ·æ–°ä»»åŠ¡æ•°æ®ç±»
 */
sealed class RefreshTask : Serializable {

    /**
     * é—´éš”åˆ·æ–°ä»»åŠ¡
     * @param intervalSeconds åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
     */
    data class Interval(
        val intervalSeconds: Long
    ) : RefreshTask() {
        override fun getDisplayName(): String = "é—´éš”åˆ·æ–°"
    }

    /**
     * å®šæ—¶åˆ·æ–°ä»»åŠ¡
     * @param targetTimeMillis ç›®æ ‡æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
     */
    data class Scheduled(
        val targetTimeMillis: Long
    ) : RefreshTask() {
        override fun getDisplayName(): String = "å®šæ—¶åˆ·æ–°"
    }

    abstract fun getDisplayName(): String

    companion object {
        private const val serialVersionUID = 1L
    }
}

/**
 * åˆ·æ–°ä»»åŠ¡çŠ¶æ€
 */
enum class RefreshState {
    IDLE,           // ç©ºé—²ï¼Œæ— ä»»åŠ¡
    COUNTING,       // å€’è®¡æ—¶ä¸­
    REFRESHING      // æ­£åœ¨åˆ·æ–°
}
</file>

<file path="app/src/main/res/color/button_text_color_refresh.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- æŒ‰ä¸‹çŠ¶æ€ï¼šç™½è‰²ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼Œå¿…é¡»æ”¾æœ€å‰é¢ï¼ï¼‰                  -->
    <!-- æ— è®ºæ˜¯é»˜è®¤ã€æ¿€æ´»è¿˜æ˜¯ä»»ä½•å…¶ä»–çŠ¶æ€ï¼ŒæŒ‰ä¸‹æ—¶éƒ½å¼ºåˆ¶å˜ç™½           -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <item android:state_pressed="true" android:color="#FFFFFF" />

    <!-- ç¦ç”¨çŠ¶æ€ï¼šç°è‰² -->
    <item android:state_enabled="false" android:color="#CCCCCC" />

    <!-- æ¿€æ´»çŠ¶æ€ï¼ˆæœ‰ä»»åŠ¡è¿è¡Œä¸­ï¼‰ï¼šçº¯é»‘è‰² -->
    <item android:state_activated="true" android:color="#000000" />

    <!-- é»˜è®¤çŠ¶æ€ï¼šçº¯é»‘è‰² -->
    <item android:color="#000000" />

</selector>
</file>

<file path="app/src/main/res/color/button_text_color.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ï¼šç™½è‰² -->
    <item android:state_pressed="true" android:color="#FFFFFF" />

    <!-- ç¦ç”¨çŠ¶æ€ï¼šç°è‰² -->
    <item android:state_enabled="false" android:color="#CCCCCC" />

    <!-- é»˜è®¤çŠ¶æ€ï¼šé»‘è‰² -->
    <item android:color="#000000" />

</selector>
</file>

<file path="app/src/main/res/color/crop_button_text_color.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ï¼šé»‘è‰²æ–‡å­—ï¼ˆé…åˆç™½è‰²èƒŒæ™¯ï¼‰ -->
    <item android:state_pressed="true" android:color="#000000" />

    <!-- é»˜è®¤çŠ¶æ€ï¼šç™½è‰²æ–‡å­— -->
    <item android:color="#FFFFFF" />

</selector>
</file>

<file path="app/src/main/res/drawable/bottom_bar_metallic.xml">
<?xml version="1.0" encoding="utf-8"?>
<layer-list xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- ç¬¬ä¸€å±‚ï¼šé¡¶éƒ¨é˜´å½±/åˆ†éš”çº¿ -->
    <item>
        <shape android:shape="rectangle">
            <gradient
                android:type="linear"
                android:angle="270"
                android:startColor="#CCCCCC"
                android:endColor="@android:color/transparent"
                android:centerY="0.1" />
        </shape>
    </item>

    <!-- ç¬¬äºŒå±‚ï¼šé‡‘å±æ¸å˜ä¸»ä½“ -->
    <item android:top="2dp">
        <shape android:shape="rectangle">
            <gradient
                android:type="linear"
                android:angle="270"
                android:startColor="#FAFAFA"
                android:centerColor="#F5F5F5"
                android:endColor="#EEEEEE" />
        </shape>
    </item>

    <!-- ç¬¬ä¸‰å±‚ï¼šé¡¶éƒ¨é«˜å…‰ -->
    <item android:top="2dp">
        <shape android:shape="rectangle">
            <gradient
                android:type="linear"
                android:angle="270"
                android:startColor="#FFFFFF"
                android:endColor="@android:color/transparent"
                android:centerY="0.05" />
        </shape>
    </item>

</layer-list>
</file>

<file path="app/src/main/res/drawable/bottom_sheet_handle_metallic.xml">
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">

    <gradient
        android:type="linear"
        android:angle="270"
        android:startColor="#CCCCCC"
        android:endColor="#AAAAAA" />
    <corners android:radius="2dp" />
    <size
        android:width="48dp"
        android:height="4dp" />

</shape>
</file>

<file path="app/src/main/res/drawable/bottom_sheet_handle.xml">
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">

    <solid android:color="#DDDDDD" />
    <corners android:radius="2dp" />

</shape>
</file>

<file path="app/src/main/res/drawable/bottom_sheet_metallic.xml">
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">

    <!-- é‡‘å±æ¸å˜èƒŒæ™¯ -->
    <gradient
        android:type="linear"
        android:angle="270"
        android:startColor="#FCFCFC"
        android:centerColor="#F5F5F5"
        android:endColor="#EEEEEE" />

    <!-- é¡¶éƒ¨åœ†è§’ -->
    <corners
        android:topLeftRadius="24dp"
        android:topRightRadius="24dp"
        android:bottomLeftRadius="0dp"
        android:bottomRightRadius="0dp" />

    <!-- ç™½è‰²ç»†æè¾¹ï¼ˆé«˜å…‰æ•ˆæœï¼‰ -->
    <stroke
        android:width="1dp"
        android:color="#FFFFFF" />

</shape>
</file>

<file path="app/src/main/res/drawable/button_crop_outline.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ï¼šé»‘è‰²å¡«å……ï¼ˆåœ¨æ·±è‰²èƒŒæ™¯ä¸Šç”¨ç™½è‰²å¡«å……æ›´é†’ç›®ï¼‰ -->
    <item android:state_pressed="true">
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <stroke
                android:width="2dp"
                android:color="#FFFFFF" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ï¼šé€æ˜ + ç™½è‰²è¾¹æ¡† -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="@android:color/transparent" />
            <stroke
                android:width="2dp"
                android:color="#FFFFFF" />
            <corners android:radius="12dp" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/button_outline_icon.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ï¼šé»‘è‰²å¡«å…… -->
    <item android:state_pressed="true">
        <shape android:shape="rectangle">
            <solid android:color="#000000" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- é€‰ä¸­çŠ¶æ€ï¼ˆPCæ¨¡å¼å¼€å¯ï¼‰ï¼šæ·±ç°å¡«å…… -->
    <item android:state_selected="true">
        <shape android:shape="rectangle">
            <solid android:color="#333333" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ï¼šé€æ˜ + é»‘è‰²è¾¹æ¡† -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="@android:color/transparent" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/button_outline.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ï¼šé»‘è‰²å¡«å…… -->
    <item android:state_pressed="true">
        <shape android:shape="rectangle">
            <solid android:color="#000000" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- ç¦ç”¨çŠ¶æ€ï¼šç°è‰²è¾¹æ¡† -->
    <item android:state_enabled="false">
        <shape android:shape="rectangle">
            <solid android:color="@android:color/transparent" />
            <stroke
                android:width="2dp"
                android:color="#CCCCCC" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ï¼šé€æ˜ + é»‘è‰²è¾¹æ¡† -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="@android:color/transparent" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/button_refresh_outline.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ -->
    <item android:state_pressed="true">
        <shape android:shape="rectangle">
            <solid android:color="#000000" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- æ¿€æ´»çŠ¶æ€ï¼ˆæœ‰å®šæ—¶ä»»åŠ¡è¿è¡Œä¸­ï¼‰ -->
    <item android:state_activated="true">
        <shape android:shape="rectangle">
            <solid android:color="#E8F5E9" />
            <stroke
                android:width="2dp"
                android:color="#2E7D32" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="@android:color/transparent" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/checkbox_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- é€‰ä¸­çŠ¶æ€ -->
    <item android:state_checked="true">
        <shape android:shape="rectangle">
            <solid android:color="#E3F2FD" />
            <corners android:radius="6dp" />
            <stroke
                android:width="1dp"
                android:color="@color/primary" />
        </shape>
    </item>
    <!-- é»˜è®¤çŠ¶æ€ -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <corners android:radius="6dp" />
            <stroke
                android:width="1dp"
                android:color="@color/edit_text_stroke" />
        </shape>
    </item>
</selector>
</file>

<file path="app/src/main/res/drawable/current_task_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">

    <solid android:color="#E8F5E9" />
    <corners android:radius="8dp" />
    <stroke
        android:width="1dp"
        android:color="#81C784" />

</shape>
</file>

<file path="app/src/main/res/drawable/dialog_background_metallic.xml">
<?xml version="1.0" encoding="utf-8"?>
<layer-list xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- å¤–å±‚ç™½è‰²è¾¹æ¡† -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <corners android:radius="16dp" />
        </shape>
    </item>

    <!-- å†…å±‚é‡‘å±æ¸å˜ -->
    <item
        android:left="1dp"
        android:top="1dp"
        android:right="1dp"
        android:bottom="1dp">
        <shape android:shape="rectangle">
            <gradient
                android:type="linear"
                android:angle="270"
                android:startColor="#F8F8F8"
                android:centerColor="#F2F2F2"
                android:endColor="#EAEAEA" />
            <corners android:radius="15dp" />
        </shape>
    </item>

</layer-list>
</file>

<file path="app/src/main/res/drawable/dialog_background_timepicker.xml">
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">

    <!-- é¥±å’Œå¤©è“è‰²å®å¿ƒèƒŒæ™¯ï¼ˆæé«˜å¯¹æ¯”åº¦ï¼‰ -->
    <solid android:color="#64B5F6" />

    <!-- 16dp åœ†è§’ -->
    <corners android:radius="16dp" />

</shape>
</file>

<file path="app/src/main/res/drawable/edit_text_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">
    <solid android:color="@color/edit_text_background" />
    <corners android:radius="8dp" />
    <stroke
        android:width="1dp"
        android:color="@color/edit_text_stroke" />
</shape>
</file>

<file path="app/src/main/res/drawable/edit_text_outline.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- è·å–ç„¦ç‚¹çŠ¶æ€ -->
    <item android:state_focused="true">
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="12dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <stroke
                android:width="1dp"
                android:color="#CCCCCC" />
            <corners android:radius="12dp" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/ic_launcher_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path
        android:fillColor="#1976D2"
        android:pathData="M0,0h108v108H0z" />
    <path
        android:fillColor="#1565C0"
        android:pathData="M0,108 L108,0 L108,20 L20,108 Z" />
    <path
        android:fillColor="#1565C0"
        android:pathData="M0,80 L80,0 L60,0 L0,60 Z" />
</vector>
</file>

<file path="app/src/main/res/drawable/ic_launcher_foreground.xml">
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path
        android:fillColor="#FFFFFF"
        android:pathData="M24,30 L84,30 Q87,30 87,33 L87,75 Q87,78 84,78 L24,78 Q21,78 21,75 L21,33 Q21,30 24,30 Z" />
    <path
        android:fillColor="#E3F2FD"
        android:pathData="M24,30 L84,30 Q87,30 87,33 L87,42 L21,42 L21,33 Q21,30 24,30 Z" />
    <path
        android:fillColor="#F44336"
        android:pathData="M28,36 m-2.5,0 a2.5,2.5 0,1 1,5 0 a2.5,2.5 0,1 1,-5 0" />
    <path
        android:fillColor="#FFC107"
        android:pathData="M36,36 m-2.5,0 a2.5,2.5 0,1 1,5 0 a2.5,2.5 0,1 1,-5 0" />
    <path
        android:fillColor="#4CAF50"
        android:pathData="M44,36 m-2.5,0 a2.5,2.5 0,1 1,5 0 a2.5,2.5 0,1 1,-5 0" />
    <path
        android:fillColor="#BBDEFB"
        android:pathData="M52,33 L80,33 Q82,33 82,35 L82,37 Q82,39 80,39 L52,39 Q50,39 50,37 L50,35 Q50,33 52,33 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M54,60 m-14,0 a14,14 0,1 1,28 0 a14,14 0,1 1,-28 0" />
    <path
        android:fillColor="#FFFFFF"
        android:pathData="M54,60 m-10,0 a10,10 0,1 1,20 0 a10,10 0,1 1,-20 0" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M54,50 L58,56 L50,56 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M62.9,54.5 L59.5,61.5 L55,55.5 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M62.9,65.5 L55,64.5 L59.5,58.5 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M54,70 L50,64 L58,64 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M45.1,65.5 L48.5,58.5 L53,64.5 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M45.1,54.5 L53,55.5 L48.5,61.5 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M54,60 m-3,0 a3,3 0,1 1,6 0 a3,3 0,1 1,-6 0" />
</vector>
</file>

<file path="app/src/main/res/drawable/icon_button_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ -->
    <item android:state_pressed="true">
        <shape android:shape="rectangle">
            <solid android:color="#E0E0E0" />
            <corners android:radius="8dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#F5F5F5" />
            <corners android:radius="8dp" />
            <stroke
                android:width="1dp"
                android:color="#DDDDDD" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/input_field_outline.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- è·å–ç„¦ç‚¹çŠ¶æ€ -->
    <item android:state_focused="true">
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <stroke
                android:width="2dp"
                android:color="#000000" />
            <corners android:radius="8dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <stroke
                android:width="1dp"
                android:color="#999999" />
            <corners android:radius="8dp" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/pc_button_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- é€‰ä¸­çŠ¶æ€ï¼ˆPC æ¨¡å¼å¼€å¯ï¼‰ -->
    <item android:state_selected="true">
        <shape android:shape="rectangle">
            <solid android:color="#E3F2FD" />
            <corners android:radius="8dp" />
            <stroke
                android:width="2dp"
                android:color="#1976D2" />
        </shape>
    </item>

    <!-- æŒ‰ä¸‹çŠ¶æ€ -->
    <item android:state_pressed="true">
        <shape android:shape="rectangle">
            <solid android:color="#E0E0E0" />
            <corners android:radius="8dp" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ï¼ˆPC æ¨¡å¼å…³é—­ï¼‰ -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#F5F5F5" />
            <corners android:radius="8dp" />
            <stroke
                android:width="1dp"
                android:color="#DDDDDD" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/spinner_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">

    <solid android:color="#FFFFFF" />
    <corners android:radius="8dp" />
    <stroke
        android:width="1dp"
        android:color="#DDDDDD" />

</shape>
</file>

<file path="app/src/main/res/drawable/time_picker_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- æŒ‰ä¸‹çŠ¶æ€ -->
    <item android:state_pressed="true">
        <shape android:shape="rectangle">
            <solid android:color="#E3F2FD" />
            <corners android:radius="8dp" />
            <stroke
                android:width="1dp"
                android:color="#1976D2" />
        </shape>
    </item>

    <!-- é»˜è®¤çŠ¶æ€ -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#FFFFFF" />
            <corners android:radius="8dp" />
            <stroke
                android:width="1dp"
                android:color="#DDDDDD" />
        </shape>
    </item>

</selector>
</file>

<file path="app/src/main/res/drawable/top_bar_metallic.xml">
<?xml version="1.0" encoding="utf-8"?>
<layer-list xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- ç¬¬ä¸€å±‚ï¼šé‡‘å±æ¸å˜ä¸»ä½“ -->
    <item>
        <shape android:shape="rectangle">
            <gradient
                android:type="linear"
                android:angle="270"
                android:startColor="#FFFFFF"
                android:centerColor="#F8F8F8"
                android:endColor="#F0F0F0" />
        </shape>
    </item>

    <!-- ç¬¬äºŒå±‚ï¼šåº•éƒ¨é˜´å½±çº¿ -->
    <item>
        <shape android:shape="rectangle">
            <gradient
                android:type="linear"
                android:angle="90"
                android:startColor="#CCCCCC"
                android:endColor="@android:color/transparent"
                android:centerY="0.05" />
        </shape>
    </item>

</layer-list>
</file>

<file path="app/src/main/res/layout/activity_crop.xml">
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="#000000">

    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <LinearLayout
        android:id="@+id/topBar"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="12dp"
        android:gravity="center_vertical"
        android:background="#CC000000"
        android:elevation="4dp"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <TextView
            android:id="@+id/textViewTitle"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="@string/crop_title"
            android:textSize="18sp"
            android:textStyle="bold"
            android:textColor="#FFFFFF" />

        <TextView
            android:id="@+id/textViewHint"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/crop_hint"
            android:textSize="12sp"
            android:textColor="#AAAAAA" />

    </LinearLayout>

    <!-- è£å‰ªåŒºåŸŸå®¹å™¨ -->
    <FrameLayout
        android:id="@+id/cropContainer"
        android:layout_width="0dp"
        android:layout_height="0dp"
        app:layout_constraintTop_toBottomOf="@id/topBar"
        app:layout_constraintBottom_toTopOf="@id/bottomBar"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <!-- åº•å±‚ï¼šå¯ç¼©æ”¾çš„å›¾ç‰‡è§†å›¾ -->
        <com.example.websnap.CropImageView
            android:id="@+id/cropImageView"
            android:layout_width="match_parent"
            android:layout_height="match_parent" />

        <!-- é¡¶å±‚ï¼šè£å‰ªæ¡†è¦†ç›–å±‚ -->
        <com.example.websnap.CropOverlayView
            android:id="@+id/cropOverlayView"
            android:layout_width="match_parent"
            android:layout_height="match_parent" />

    </FrameLayout>

    <!-- åº•éƒ¨æŒ‰é’®æ  -->
    <LinearLayout
        android:id="@+id/bottomBar"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:paddingHorizontal="16dp"
        android:paddingVertical="12dp"
        android:gravity="center"
        android:background="#CC000000"
        android:elevation="4dp"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <!-- å–æ¶ˆæŒ‰é’® -->
        <Button
            android:id="@+id/buttonCancel"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:layout_marginEnd="8dp"
            android:text="@string/crop_button_cancel"
            android:textSize="14sp"
            android:textColor="@color/crop_button_text_color"
            android:background="@drawable/button_crop_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null" />

        <!-- é‡ç½®æŒ‰é’® -->
        <Button
            android:id="@+id/buttonReset"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:layout_marginHorizontal="8dp"
            android:text="@string/crop_button_reset"
            android:textSize="14sp"
            android:textColor="@color/crop_button_text_color"
            android:background="@drawable/button_crop_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null" />

        <!-- ä¿å­˜æŒ‰é’® -->
        <Button
            android:id="@+id/buttonSave"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:layout_marginStart="8dp"
            android:text="@string/crop_button_save"
            android:textSize="14sp"
            android:textStyle="bold"
            android:textColor="@color/crop_button_text_color"
            android:background="@drawable/button_crop_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null" />

    </LinearLayout>

</androidx.constraintlayout.widget.ConstraintLayout>
</file>

<file path="app/src/main/res/layout/activity_main.xml">
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fitsSystemWindows="true"
    android:background="#FFFFFF"
    tools:context=".MainActivity">

    <LinearLayout
        android:id="@+id/urlBarContainer"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="10dp"
        android:gravity="center_vertical"
        android:background="@drawable/top_bar_metallic"
        android:elevation="4dp"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <EditText
            android:id="@+id/editTextUrl"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:hint="@string/hint_enter_url"
            android:inputType="textUri"
            android:imeOptions="actionGo"
            android:singleLine="true"
            android:maxLines="1"
            android:paddingHorizontal="14dp"
            android:background="@drawable/edit_text_outline"
            android:textSize="14sp"
            android:textColor="#000000"
            android:textColorHint="#999999"
            android:autofillHints="no"
            tools:text="https://example.com" />

        <Button
            android:id="@+id/buttonGo"
            android:layout_width="56dp"
            android:layout_height="48dp"
            android:layout_marginStart="8dp"
            android:padding="0dp"
            android:text="@string/button_go"
            android:textSize="14sp"
            android:textStyle="bold"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null" />

        <Button
            android:id="@+id/buttonBookmark"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:layout_marginStart="8dp"
            android:padding="0dp"
            android:text="@string/button_bookmark_empty"
            android:textSize="18sp"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline_icon"
            android:stateListAnimator="@null"
            android:contentDescription="@string/content_desc_bookmark"
            app:backgroundTint="@null"
            tools:text="â˜†" />

        <Button
            android:id="@+id/buttonPcMode"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:layout_marginStart="8dp"
            android:padding="0dp"
            android:text="@string/button_pc_mode"
            android:textSize="16sp"
            android:background="@drawable/button_outline_icon"
            android:stateListAnimator="@null"
            android:contentDescription="@string/content_desc_pc_mode"
            app:backgroundTint="@null"
            tools:text="ğŸ’»" />
    </LinearLayout>

    <ProgressBar
        android:id="@+id/progressBar"
        style="@style/Widget.AppCompat.ProgressBar.Horizontal"
        android:layout_width="0dp"
        android:layout_height="3dp"
        android:indeterminate="false"
        android:max="100"
        android:progress="0"
        android:progressTint="#000000"
        android:progressBackgroundTint="#E0E0E0"
        android:visibility="gone"
        app:layout_constraintTop_toBottomOf="@id/urlBarContainer"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        tools:visibility="visible"
        tools:progress="50" />

    <WebView
        android:id="@+id/webView"
        android:layout_width="0dp"
        android:layout_height="0dp"
        app:layout_constraintTop_toBottomOf="@id/progressBar"
        app:layout_constraintBottom_toTopOf="@id/bottomButtonContainer"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <LinearLayout
        android:id="@+id/bottomButtonContainer"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:paddingHorizontal="10dp"
        android:paddingVertical="10dp"
        android:gravity="center_vertical"
        android:background="@drawable/bottom_bar_metallic"
        android:elevation="8dp"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <Button
            android:id="@+id/buttonBack"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:padding="0dp"
            android:gravity="center"
            android:text="@string/button_back"
            android:textSize="20sp"
            android:textStyle="bold"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            android:enabled="false"
            android:contentDescription="@string/content_desc_back"
            app:backgroundTint="@null"
            tools:enabled="true" />

        <Button
            android:id="@+id/buttonHome"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:layout_marginStart="8dp"
            android:padding="0dp"
            android:gravity="center"
            android:text="@string/button_home"
            android:textSize="18sp"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline_icon"
            android:stateListAnimator="@null"
            android:contentDescription="@string/content_desc_home"
            app:backgroundTint="@null" />

        <Button
            android:id="@+id/buttonRefresh"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:layout_marginHorizontal="8dp"
            android:padding="0dp"
            android:paddingBottom="3dp"
            android:gravity="center"
            android:text="@string/button_refresh_default"
            android:fontFamily="@font/digital_7_mono"
            android:textSize="28sp"
            android:textStyle="bold"
            android:textColor="@color/button_text_color_refresh"
            android:includeFontPadding="false"
            android:background="@drawable/button_refresh_outline"
            android:stateListAnimator="@null"
            android:contentDescription="@string/content_desc_refresh"
            app:backgroundTint="@null"
            tools:text="â±ï¸ 04:32" />

        <Button
            android:id="@+id/buttonCapture"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:padding="0dp"
            android:gravity="center"
            android:text="@string/button_capture_icon"
            android:textSize="20sp"
            android:background="@drawable/button_outline_icon"
            android:stateListAnimator="@null"
            android:contentDescription="@string/content_desc_capture"
            app:backgroundTint="@null" />

        <Button
            android:id="@+id/buttonForward"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:layout_marginStart="8dp"
            android:padding="0dp"
            android:gravity="center"
            android:text="@string/button_forward"
            android:textSize="20sp"
            android:textStyle="bold"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            android:enabled="false"
            android:contentDescription="@string/content_desc_forward"
            app:backgroundTint="@null"
            tools:enabled="true" />
    </LinearLayout>
</androidx.constraintlayout.widget.ConstraintLayout>
</file>

<file path="app/src/main/res/layout/bottom_sheet_bookmarks.xml">
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:background="@drawable/bottom_sheet_metallic"
    android:paddingBottom="20dp">

    <!-- æ‹–åŠ¨æŒ‡ç¤ºæ¡ - é‡‘å±é£æ ¼ -->
    <View
        android:id="@+id/dragHandle"
        android:layout_width="48dp"
        android:layout_height="4dp"
        android:layout_marginTop="12dp"
        android:background="@drawable/bottom_sheet_handle_metallic"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- æ ‡é¢˜æ  -->
    <TextView
        android:id="@+id/textViewTitle"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="20dp"
        android:layout_marginHorizontal="20dp"
        android:text="@string/bookmark_sheet_title"
        android:textSize="18sp"
        android:textStyle="bold"
        android:textColor="#000000"
        app:layout_constraintTop_toBottomOf="@id/dragHandle"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- åˆ†éš”çº¿ -->
    <View
        android:id="@+id/divider"
        android:layout_width="0dp"
        android:layout_height="1dp"
        android:layout_marginTop="16dp"
        android:layout_marginHorizontal="20dp"
        android:background="#CCCCCC"
        app:layout_constraintTop_toBottomOf="@id/textViewTitle"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- ä¹¦ç­¾åˆ—è¡¨ -->
    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/recyclerViewBookmarks"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:maxHeight="400dp"
        android:clipToPadding="false"
        android:paddingVertical="8dp"
        android:overScrollMode="never"
        app:layout_constraintTop_toBottomOf="@id/divider"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constrainedHeight="true"
        tools:listitem="@layout/item_bookmark"
        tools:itemCount="3" />

    <!-- ç©ºçŠ¶æ€æç¤º -->
    <LinearLayout
        android:id="@+id/emptyStateContainer"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:gravity="center"
        android:padding="40dp"
        android:visibility="gone"
        app:layout_constraintTop_toBottomOf="@id/divider"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        tools:visibility="visible">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/bookmark_empty_icon"
            android:textSize="48sp" />

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:text="@string/bookmark_empty_hint"
            android:textSize="14sp"
            android:textColor="#666666"
            android:gravity="center" />

    </LinearLayout>

</androidx.constraintlayout.widget.ConstraintLayout>
</file>

<file path="app/src/main/res/layout/bottom_sheet_refresh.xml">
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:background="@drawable/bottom_sheet_metallic"
    android:paddingBottom="24dp">

    <!-- æ‹–åŠ¨æŒ‡ç¤ºæ¡ -->
    <View
        android:id="@+id/dragHandle"
        android:layout_width="48dp"
        android:layout_height="4dp"
        android:layout_marginTop="12dp"
        android:background="@drawable/bottom_sheet_handle_metallic"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- æ ‡é¢˜ -->
    <TextView
        android:id="@+id/textViewTitle"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="20dp"
        android:layout_marginHorizontal="20dp"
        android:text="@string/refresh_sheet_title"
        android:textSize="18sp"
        android:textStyle="bold"
        android:textColor="#000000"
        app:layout_constraintTop_toBottomOf="@id/dragHandle"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- åˆ†éš”çº¿ -->
    <View
        android:id="@+id/divider1"
        android:layout_width="0dp"
        android:layout_height="1dp"
        android:layout_marginTop="16dp"
        android:layout_marginHorizontal="20dp"
        android:background="#CCCCCC"
        app:layout_constraintTop_toBottomOf="@id/textViewTitle"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- é—´éš”åˆ·æ–°é€‰é¡¹ -->
    <RadioButton
        android:id="@+id/radioInterval"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="20dp"
        android:layout_marginHorizontal="20dp"
        android:text="@string/refresh_option_interval"
        android:textSize="16sp"
        android:textColor="#000000"
        android:textStyle="bold"
        android:buttonTint="#000000"
        app:layout_constraintTop_toBottomOf="@id/divider1"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <LinearLayout
        android:id="@+id/containerInterval"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="12dp"
        android:layout_marginStart="48dp"
        android:layout_marginEnd="20dp"
        android:orientation="horizontal"
        android:gravity="center_vertical"
        app:layout_constraintTop_toBottomOf="@id/radioInterval"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/refresh_interval_prefix"
            android:textSize="14sp"
            android:textColor="#333333" />

        <Spinner
            android:id="@+id/spinnerInterval"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:layout_marginHorizontal="10dp"
            android:background="@drawable/input_field_outline"
            android:padding="8dp"
            android:popupBackground="@drawable/dialog_background_metallic" />

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/refresh_interval_suffix"
            android:textSize="14sp"
            android:textColor="#333333" />

    </LinearLayout>

    <!-- è‡ªå®šä¹‰æŒ‰é’® - ä¿®å¤ Tint -->
    <Button
        android:id="@+id/buttonCustomInterval"
        android:layout_width="wrap_content"
        android:layout_height="40dp"
        android:layout_marginTop="10dp"
        android:layout_marginStart="48dp"
        android:paddingHorizontal="16dp"
        android:text="@string/refresh_custom_interval"
        android:textSize="13sp"
        android:textColor="@color/button_text_color"
        android:background="@drawable/button_outline"
        android:stateListAnimator="@null"
        app:backgroundTint="@null"
        app:layout_constraintTop_toBottomOf="@id/containerInterval"
        app:layout_constraintStart_toStartOf="parent" />

    <!-- å®šæ—¶åˆ·æ–°é€‰é¡¹ -->
    <RadioButton
        android:id="@+id/radioScheduled"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:layout_marginHorizontal="20dp"
        android:text="@string/refresh_option_scheduled"
        android:textSize="16sp"
        android:textColor="#000000"
        android:textStyle="bold"
        android:buttonTint="#000000"
        app:layout_constraintTop_toBottomOf="@id/buttonCustomInterval"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <LinearLayout
        android:id="@+id/containerScheduled"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="12dp"
        android:layout_marginStart="48dp"
        android:layout_marginEnd="20dp"
        android:orientation="horizontal"
        android:gravity="center_vertical"
        app:layout_constraintTop_toBottomOf="@id/radioScheduled"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/refresh_scheduled_prefix"
            android:textSize="14sp"
            android:textColor="#333333" />

        <!-- æ—¶é—´é€‰æ‹©æŒ‰é’® - ä¿®å¤ Tint -->
        <Button
            android:id="@+id/buttonPickTime"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:layout_marginStart="10dp"
            android:text="@string/refresh_pick_time"
            android:textSize="16sp"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null"
            tools:text="14:30:00" />

    </LinearLayout>

    <!-- åˆ†éš”çº¿ -->
    <View
        android:id="@+id/divider2"
        android:layout_width="0dp"
        android:layout_height="1dp"
        android:layout_marginTop="24dp"
        android:layout_marginHorizontal="20dp"
        android:background="#CCCCCC"
        app:layout_constraintTop_toBottomOf="@id/containerScheduled"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- å½“å‰ä»»åŠ¡çŠ¶æ€ -->
    <LinearLayout
        android:id="@+id/containerCurrentTask"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:layout_marginHorizontal="20dp"
        android:orientation="horizontal"
        android:gravity="center_vertical"
        android:padding="14dp"
        android:background="@drawable/current_task_background"
        android:visibility="gone"
        app:layout_constraintTop_toBottomOf="@id/divider2"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        tools:visibility="visible">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/refresh_current_task_icon"
            android:textSize="20sp" />

        <TextView
            android:id="@+id/textViewCurrentTask"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginStart="12dp"
            android:textSize="14sp"
            android:textColor="#1B5E20"
            tools:text="é—´éš”åˆ·æ–°ï¼šæ¯ 5 åˆ†é’Ÿ | å€’è®¡æ—¶ 03:42" />

    </LinearLayout>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <LinearLayout
        android:id="@+id/containerButtons"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="20dp"
        android:layout_marginHorizontal="20dp"
        android:orientation="horizontal"
        android:gravity="center"
        app:layout_constraintTop_toBottomOf="@id/containerCurrentTask"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent">

        <!-- å–æ¶ˆä»»åŠ¡æŒ‰é’® - ä¿®å¤ Tint -->
        <Button
            android:id="@+id/buttonCancelTask"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:layout_marginEnd="10dp"
            android:text="@string/refresh_button_cancel"
            android:textSize="14sp"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            android:visibility="gone"
            app:backgroundTint="@null"
            tools:visibility="visible" />

        <!-- ç¡®è®¤è®¾ç½®æŒ‰é’® - ä¿®å¤ Tint -->
        <Button
            android:id="@+id/buttonConfirm"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:text="@string/refresh_button_confirm"
            android:textSize="14sp"
            android:textStyle="bold"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null" />

    </LinearLayout>

</androidx.constraintlayout.widget.ConstraintLayout>
</file>

<file path="app/src/main/res/layout/dialog_custom_interval.xml">
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:padding="24dp"
    android:background="@drawable/dialog_background_metallic">

    <!-- æ ‡é¢˜ -->
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/dialog_custom_interval_title"
        android:textSize="18sp"
        android:textStyle="bold"
        android:textColor="#000000" />

    <!-- è¯´æ˜ -->
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:text="@string/dialog_custom_interval_hint"
        android:textSize="13sp"
        android:textColor="#666666" />

    <!-- è¾“å…¥åŒºåŸŸ -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:orientation="horizontal"
        android:gravity="center_vertical">

        <!-- å°æ—¶ -->
        <LinearLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:orientation="vertical"
            android:gravity="center">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="@string/dialog_label_hours"
                android:textSize="12sp"
                android:textColor="#666666" />

            <EditText
                android:id="@+id/editTextHours"
                android:layout_width="64dp"
                android:layout_height="56dp"
                android:layout_marginTop="8dp"
                android:background="@drawable/input_field_outline"
                android:gravity="center"
                android:inputType="number"
                android:maxLength="2"
                android:textSize="20sp"
                android:textStyle="bold"
                android:textColor="#000000"
                android:hint="0"
                android:textColorHint="#CCCCCC"
                tools:text="0" />

        </LinearLayout>

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text=":"
            android:textSize="24sp"
            android:textStyle="bold"
            android:textColor="#000000"
            android:layout_marginHorizontal="8dp" />

        <!-- åˆ†é’Ÿ -->
        <LinearLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:orientation="vertical"
            android:gravity="center">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="@string/dialog_label_minutes"
                android:textSize="12sp"
                android:textColor="#666666" />

            <EditText
                android:id="@+id/editTextMinutes"
                android:layout_width="64dp"
                android:layout_height="56dp"
                android:layout_marginTop="8dp"
                android:background="@drawable/input_field_outline"
                android:gravity="center"
                android:inputType="number"
                android:maxLength="2"
                android:textSize="20sp"
                android:textStyle="bold"
                android:textColor="#000000"
                android:hint="5"
                android:textColorHint="#CCCCCC"
                tools:text="5" />

        </LinearLayout>

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text=":"
            android:textSize="24sp"
            android:textStyle="bold"
            android:textColor="#000000"
            android:layout_marginHorizontal="8dp" />

        <!-- ç§’ -->
        <LinearLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:orientation="vertical"
            android:gravity="center">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="@string/dialog_label_seconds"
                android:textSize="12sp"
                android:textColor="#666666" />

            <EditText
                android:id="@+id/editTextSeconds"
                android:layout_width="64dp"
                android:layout_height="56dp"
                android:layout_marginTop="8dp"
                android:background="@drawable/input_field_outline"
                android:gravity="center"
                android:inputType="number"
                android:maxLength="2"
                android:textSize="20sp"
                android:textStyle="bold"
                android:textColor="#000000"
                android:hint="0"
                android:textColorHint="#CCCCCC"
                tools:text="0" />

        </LinearLayout>

    </LinearLayout>

    <!-- æŒ‰é’®åŒºåŸŸ -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="28dp"
        android:orientation="horizontal"
        android:gravity="end">

        <Button
            android:id="@+id/buttonCancel"
            android:layout_width="wrap_content"
            android:layout_height="44dp"
            android:paddingHorizontal="20dp"
            android:text="@string/dialog_button_cancel"
            android:textSize="14sp"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null" />

        <Button
            android:id="@+id/buttonOk"
            android:layout_width="wrap_content"
            android:layout_height="44dp"
            android:layout_marginStart="12dp"
            android:paddingHorizontal="24dp"
            android:text="@string/dialog_button_ok"
            android:textSize="14sp"
            android:textStyle="bold"
            android:textColor="@color/button_text_color"
            android:background="@drawable/button_outline"
            android:stateListAnimator="@null"
            app:backgroundTint="@null" />

    </LinearLayout>

</LinearLayout>
</file>

<file path="app/src/main/res/layout/item_bookmark.xml">
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:background="?attr/selectableItemBackground"
    android:paddingVertical="12dp"
    android:paddingStart="20dp"
    android:paddingEnd="12dp">

    <!-- ä¹¦ç­¾å›¾æ ‡ -->
    <TextView
        android:id="@+id/textViewIcon"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/bookmark_item_icon"
        android:textSize="20sp"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent" />

    <!-- æ ‡é¢˜ -->
    <TextView
        android:id="@+id/textViewTitle"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginStart="14dp"
        android:layout_marginEnd="12dp"
        android:textSize="15sp"
        android:textColor="#000000"
        android:maxLines="1"
        android:ellipsize="end"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toEndOf="@id/textViewIcon"
        app:layout_constraintEnd_toStartOf="@id/buttonDelete"
        tools:text="GitHub - Where the world builds software" />

    <!-- URL -->
    <TextView
        android:id="@+id/textViewUrl"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginStart="14dp"
        android:layout_marginEnd="12dp"
        android:layout_marginTop="3dp"
        android:textSize="12sp"
        android:textColor="#666666"
        android:maxLines="1"
        android:ellipsize="end"
        app:layout_constraintTop_toBottomOf="@id/textViewTitle"
        app:layout_constraintStart_toEndOf="@id/textViewIcon"
        app:layout_constraintEnd_toStartOf="@id/buttonDelete"
        tools:text="https://github.com" />

    <!-- åˆ é™¤æŒ‰é’® - çº¿æ¡†é£æ ¼ -->
    <Button
        android:id="@+id/buttonDelete"
        android:layout_width="40dp"
        android:layout_height="40dp"
        android:padding="0dp"
        android:gravity="center"
        android:text="@string/bookmark_delete_icon"
        android:textSize="14sp"
        android:textColor="@color/button_text_color"
        android:background="@drawable/button_outline_icon"
        android:stateListAnimator="@null"
        android:contentDescription="@string/content_desc_delete_bookmark"
        app:backgroundTint="@null"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
</file>

<file path="app/src/main/res/mipmap-anydpi-v26/ic_launcher_round.xml">
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>
</file>

<file path="app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml">
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>
</file>

<file path="app/src/main/res/mipmap-hdpi/ic_launcher_round.xml">
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="48dp"
    android:height="48dp"
    android:viewportWidth="48"
    android:viewportHeight="48">
    <path
        android:fillColor="#1976D2"
        android:pathData="M24,24 m-22,0 a22,22 0,1 1,44 0 a22,22 0,1 1,-44 0" />
    <path
        android:fillColor="#FFFFFF"
        android:pathData="M24,14 L28,18 L36,18 Q38,18 38,20 L38,34 Q38,36 36,36 L12,36 Q10,36 10,34 L10,20 Q10,18 12,18 L20,18 L24,14 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M24,27 m-7,0 a7,7 0,1 1,14 0 a7,7 0,1 1,-14 0" />
    <path
        android:fillColor="#FFFFFF"
        android:pathData="M24,27 m-4,0 a4,4 0,1 1,8 0 a4,4 0,1 1,-8 0" />
</vector>
</file>

<file path="app/src/main/res/mipmap-hdpi/ic_launcher.xml">
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="48dp"
    android:height="48dp"
    android:viewportWidth="48"
    android:viewportHeight="48">
    <path
        android:fillColor="#1976D2"
        android:pathData="M24,24 m-22,0 a22,22 0,1 1,44 0 a22,22 0,1 1,-44 0" />
    <path
        android:fillColor="#FFFFFF"
        android:pathData="M24,14 L28,18 L36,18 Q38,18 38,20 L38,34 Q38,36 36,36 L12,36 Q10,36 10,34 L10,20 Q10,18 12,18 L20,18 L24,14 Z" />
    <path
        android:fillColor="#1976D2"
        android:pathData="M24,27 m-7,0 a7,7 0,1 1,14 0 a7,7 0,1 1,-14 0" />
    <path
        android:fillColor="#FFFFFF"
        android:pathData="M24,27 m-4,0 a4,4 0,1 1,8 0 a4,4 0,1 1,-8 0" />
</vector>
</file>

<file path="app/src/main/res/values/arrays.xml">
<?xml version="1.0" encoding="utf-8"?>
<resources>

    <!-- é—´éš”åˆ·æ–°é€‰é¡¹ï¼ˆæ˜¾ç¤ºæ–‡æœ¬ï¼‰ -->
    <string-array name="interval_options">
        <item>10 ç§’</item>
        <item>30 ç§’</item>
        <item>1 åˆ†é’Ÿ</item>
        <item>3 åˆ†é’Ÿ</item>
        <item>5 åˆ†é’Ÿ</item>
        <item>10 åˆ†é’Ÿ</item>
        <item>30 åˆ†é’Ÿ</item>
    </string-array>

    <!-- é—´éš”åˆ·æ–°é€‰é¡¹ï¼ˆç§’æ•°å€¼ï¼‰ -->
    <integer-array name="interval_values">
        <item>10</item>
        <item>30</item>
        <item>60</item>
        <item>180</item>
        <item>300</item>
        <item>600</item>
        <item>1800</item>
    </integer-array>

</resources>
</file>

<file path="app/src/main/res/values/colors.xml">
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- ä¸»é¢˜è‰² -->
    <color name="primary">#1976D2</color>
    <color name="primary_dark">#1565C0</color>
    <color name="accent">#FF6F00</color>

    <!-- èƒŒæ™¯è‰² -->
    <color name="url_bar_background">#F5F5F5</color>
    <color name="bottom_bar_background">#FAFAFA</color>
    <color name="edit_text_background">#FFFFFF</color>
    <color name="edit_text_stroke">#DDDDDD</color>

    <!-- æ–‡å­—é¢œè‰² -->
    <color name="text_primary">#212121</color>
    <color name="text_secondary">#757575</color>
    <color name="text_hint">#9E9E9E</color>

    <!-- è¿›åº¦æ¡é¢œè‰² -->
    <color name="progress_color">#1976D2</color>

    <!-- çŠ¶æ€æ  -->
    <color name="status_bar">#1565C0</color>

    <!-- æŒ‰é’®é¢œè‰² -->
    <color name="button_cancel_background">#E0E0E0</color>
    <color name="button_refresh_active">#4CAF50</color>
</resources>
</file>

<file path="app/src/main/res/values/strings.xml">
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- åº”ç”¨åç§° -->
    <string name="app_name">WebSnap</string>

    <!-- åœ°å€æ  -->
    <string name="hint_enter_url">è¾“å…¥ç½‘å€</string>
    <string name="button_go">GO</string>

    <!-- é¡¶éƒ¨æŒ‰é’® -->
    <string name="button_bookmark_empty">â˜†</string>
    <string name="button_bookmark_filled">â˜…</string>
    <string name="button_pc_mode">ğŸ’»</string>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <string name="button_back">&lt;</string>
    <string name="button_forward">&gt;</string>
    <string name="button_home">ğŸ </string>
    <string name="button_capture_icon">ğŸ“·</string>
    <string name="button_refresh_default">ğŸ”„ åˆ·æ–°</string>
    <string name="button_refresh_countdown">â±ï¸ %1$s</string>
    <string name="button_refresh_scheduled">ğŸ• %1$s</string>
    <string name="button_refreshing">åˆ·æ–°ä¸­â€¦</string>

    <!-- æ— éšœç¢æè¿° -->
    <string name="content_desc_back">åé€€</string>
    <string name="content_desc_forward">å‰è¿›</string>
    <string name="content_desc_home">ä¸»é¡µ</string>
    <string name="content_desc_bookmark">ä¹¦ç­¾</string>
    <string name="content_desc_pc_mode">PC æ¨¡å¼</string>
    <string name="content_desc_capture">æˆªå›¾</string>
    <string name="content_desc_refresh">åˆ·æ–°</string>
    <string name="content_desc_delete_bookmark">åˆ é™¤ä¹¦ç­¾</string>

    <!-- Toast æç¤ºæ¶ˆæ¯ -->
    <string name="toast_url_empty">è¯·è¾“å…¥ç½‘å€</string>
    <string name="toast_page_not_loaded">è¯·å…ˆåŠ è½½ç½‘é¡µ</string>
    <string name="toast_capture_success">æˆªå›¾å·²ä¿å­˜åˆ°ç›¸å†Œ</string>
    <string name="toast_capture_failed">æˆªå›¾å¤±è´¥ï¼Œè¯·é‡è¯•</string>
    <string name="toast_page_too_long">é¡µé¢è¿‡é•¿ï¼Œå·²æˆªå–å‰ %1$d åƒç´ </string>
    <string name="toast_memory_insufficient">å†…å­˜ä¸è¶³ï¼Œæ— æ³•æˆªå–æ­¤é¡µé¢</string>
    <string name="toast_loading">æ­£åœ¨åŠ è½½â€¦</string>

    <!-- æˆªå›¾åŠŸèƒ½ -->
    <string name="toast_capture_visible">å·²æˆªå–å½“å‰å±å¹•</string>
    <string name="toast_capture_fullpage">å·²æˆªå–å®Œæ•´ç½‘é¡µ</string>

    <!-- PC æ¨¡å¼ -->
    <string name="toast_pc_mode_on">å·²åˆ‡æ¢åˆ°æ¡Œé¢æ¨¡å¼ï¼Œå¯åŒæŒ‡ç¼©æ”¾</string>
    <string name="toast_pc_mode_off">å·²åˆ‡æ¢åˆ°ç§»åŠ¨æ¨¡å¼</string>

    <!-- URL Scheme æ‹¦æˆª -->
    <string name="toast_scheme_blocked">å·²æ‹¦æˆªåº”ç”¨è·³è½¬</string>

    <!-- ä¹¦ç­¾åŠŸèƒ½ -->
    <string name="toast_bookmark_added">å·²æ·»åŠ ä¹¦ç­¾</string>
    <string name="toast_bookmark_removed">å·²ç§»é™¤ä¹¦ç­¾</string>
    <string name="toast_bookmark_deleted">å·²åˆ é™¤ã€Œ%1$sã€</string>
    <string name="toast_bookmark_exists">å·²åœ¨ä¹¦ç­¾ä¸­</string>
    <string name="toast_bookmark_need_page">è¯·å…ˆåŠ è½½ç½‘é¡µ</string>

    <!-- ä¹¦ç­¾åˆ—è¡¨ (BottomSheet) -->
    <string name="bookmark_sheet_title">ğŸ“‘ æˆ‘çš„ä¹¦ç­¾</string>
    <string name="bookmark_empty_icon">ğŸ“­</string>
    <string name="bookmark_empty_hint">æš‚æ— ä¹¦ç­¾\nç‚¹å‡» â˜† æ·»åŠ å½“å‰é¡µé¢</string>
    <string name="bookmark_item_icon">ğŸ”–</string>
    <string name="bookmark_delete_icon">âœ•</string>

    <!-- åˆ·æ–°åŠŸèƒ½ -->
    <string name="toast_refresh_started">å·²è®¾ç½®è‡ªåŠ¨åˆ·æ–°</string>
    <string name="toast_refresh_cancelled">å·²å–æ¶ˆè‡ªåŠ¨åˆ·æ–°</string>
    <string name="toast_refresh_need_page">è¯·å…ˆåŠ è½½ç½‘é¡µ</string>
    <string name="toast_refresh_select_mode">è¯·é€‰æ‹©åˆ·æ–°æ¨¡å¼</string>
    <string name="toast_refresh_select_time">è¯·é€‰æ‹©åˆ·æ–°æ—¶é—´</string>

    <!-- åˆ·æ–°è®¾ç½® (BottomSheet) -->
    <string name="refresh_sheet_title">â±ï¸ è®¾ç½®è‡ªåŠ¨åˆ·æ–°</string>
    <string name="refresh_option_interval">é—´éš”åˆ·æ–°</string>
    <string name="refresh_option_scheduled">å®šæ—¶åˆ·æ–°</string>
    <string name="refresh_interval_prefix">æ¯</string>
    <string name="refresh_interval_suffix">åˆ·æ–°ä¸€æ¬¡</string>
    <string name="refresh_scheduled_prefix">åœ¨</string>
    <string name="refresh_pick_time">ç‚¹å‡»é€‰æ‹©æ—¶é—´</string>
    <string name="refresh_current_task_icon">âœ…</string>
    <string name="refresh_current_task_interval">é—´éš”åˆ·æ–°ï¼šæ¯ %1$s | å€’è®¡æ—¶ %2$s</string>
    <string name="refresh_current_task_scheduled">å®šæ—¶åˆ·æ–°ï¼šç›®æ ‡ %1$s</string>
    <string name="refresh_button_cancel">å–æ¶ˆä»»åŠ¡</string>
    <string name="refresh_button_confirm">ç¡®è®¤è®¾ç½®</string>

    <!-- é—´éš”é€‰é¡¹ -->
    <string name="interval_10_sec">10 ç§’</string>
    <string name="interval_30_sec">30 ç§’</string>
    <string name="interval_1_min">1 åˆ†é’Ÿ</string>
    <string name="interval_3_min">3 åˆ†é’Ÿ</string>
    <string name="interval_5_min">5 åˆ†é’Ÿ</string>
    <string name="interval_10_min">10 åˆ†é’Ÿ</string>
    <string name="interval_30_min">30 åˆ†é’Ÿ</string>

    <!-- è‡ªå®šä¹‰é—´éš”å¯¹è¯æ¡† -->
    <string name="refresh_custom_interval">è‡ªå®šä¹‰â€¦</string>
    <string name="dialog_custom_interval_title">è‡ªå®šä¹‰åˆ·æ–°é—´éš”</string>
    <string name="dialog_custom_interval_hint">è¯·è¾“å…¥åˆ·æ–°é—´éš”æ—¶é—´</string>
    <string name="dialog_label_hours">å°æ—¶</string>
    <string name="dialog_label_minutes">åˆ†é’Ÿ</string>
    <string name="dialog_label_seconds">ç§’</string>
    <string name="dialog_button_cancel">å–æ¶ˆ</string>
    <string name="dialog_button_ok">ç¡®å®š</string>
    <string name="toast_invalid_interval">è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¶é—´é—´éš”</string>

    <!-- è£å‰ªç•Œé¢ -->
    <string name="crop_title">è£å‰ªå›¾ç‰‡</string>
    <string name="crop_hint">æ‹–åŠ¨è¾¹ç¼˜è°ƒæ•´åŒºåŸŸ</string>
    <string name="crop_button_cancel">å–æ¶ˆ</string>
    <string name="crop_button_reset">é‡ç½®</string>
    <string name="crop_button_save">âœ“ ä¿å­˜</string>
    <string name="toast_crop_saved">è£å‰ªåçš„å›¾ç‰‡å·²ä¿å­˜</string>
    <string name="toast_crop_failed">ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•</string>
    <string name="toast_crop_cancelled">å·²å–æ¶ˆ</string>
    <string name="toast_crop_no_image">æ²¡æœ‰å¯è£å‰ªçš„å›¾ç‰‡</string>
    <string name="toast_crop_area_too_small">è£å‰ªåŒºåŸŸå¤ªå°</string>

    <!-- æƒé™ç›¸å…³ -->
    <string name="toast_permission_camera_denied">ç›¸æœºæƒé™è¢«æ‹’ç»</string>
    <string name="toast_permission_mic_denied">éº¦å…‹é£æƒé™è¢«æ‹’ç»</string>
    <string name="toast_permission_storage_denied">å­˜å‚¨æƒé™è¢«æ‹’ç»</string>
    <string name="toast_permission_required">éœ€è¦æƒé™æ‰èƒ½ç»§ç»­</string>

    <!-- æ–‡ä»¶é€‰æ‹© -->
    <string name="toast_file_picker_error">æ— æ³•æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨</string>

    <!-- WebView é”™è¯¯ -->
    <string name="error_page_title">åŠ è½½å¤±è´¥</string>
    <string name="error_page_message">æ— æ³•åŠ è½½æ­¤é¡µé¢\n%1$s</string>
</resources>
</file>

<file path="app/src/main/res/values/themes.xml">
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- ä¸»åº”ç”¨ä¸»é¢˜ -->
    <style name="Theme.WebSnap" parent="Theme.MaterialComponents.Light.NoActionBar">
        <item name="colorPrimary">@color/primary</item>
        <item name="colorPrimaryDark">@color/primary_dark</item>
        <item name="colorAccent">@color/accent</item>
        <item name="android:statusBarColor">@color/status_bar</item>
        <item name="materialButtonStyle">@style/Widget.WebSnap.Button.Outline</item>
        <item name="colorControlActivated">@color/progress_color</item>
        <item name="bottomSheetDialogTheme">@style/Theme.WebSnap.BottomSheet</item>
        <item name="alertDialogTheme">@style/Theme.WebSnap.AlertDialog</item>
    </style>

    <!-- çº¿æ¡†æŒ‰é’®æ ·å¼ -->
    <style name="Widget.WebSnap.Button.Outline" parent="Widget.MaterialComponents.Button.TextButton">
        <item name="backgroundTint">@null</item>
        <item name="android:background">@drawable/button_outline</item>
        <item name="android:textColor">@color/button_text_color</item>
        <item name="android:stateListAnimator">@null</item>
        <item name="cornerRadius">12dp</item>
        <item name="rippleColor">@android:color/transparent</item>
    </style>

    <!-- BottomSheet ä¸»é¢˜ -->
    <style name="Theme.WebSnap.BottomSheet" parent="Theme.MaterialComponents.Light.BottomSheetDialog">
        <item name="bottomSheetStyle">@style/Widget.WebSnap.BottomSheet</item>
        <item name="android:windowIsFloating">false</item>
        <item name="android:windowBackground">@android:color/transparent</item>
        <item name="android:backgroundDimEnabled">true</item>
        <item name="android:backgroundDimAmount">0.5</item>
    </style>

    <style name="Widget.WebSnap.BottomSheet" parent="Widget.MaterialComponents.BottomSheet">
        <item name="shapeAppearanceOverlay">@style/ShapeAppearance.WebSnap.BottomSheet</item>
        <item name="backgroundTint">@android:color/transparent</item>
        <item name="android:background">@android:color/transparent</item>
    </style>

    <style name="ShapeAppearance.WebSnap.BottomSheet" parent="">
        <item name="cornerFamily">rounded</item>
        <item name="cornerSizeTopLeft">24dp</item>
        <item name="cornerSizeTopRight">24dp</item>
        <item name="cornerSizeBottomLeft">0dp</item>
        <item name="cornerSizeBottomRight">0dp</item>
    </style>

    <!-- AlertDialog ä¸»é¢˜ -->
    <style name="Theme.WebSnap.AlertDialog" parent="ThemeOverlay.MaterialComponents.MaterialAlertDialog">
        <item name="android:windowBackground">@android:color/transparent</item>
        <item name="android:background">@drawable/dialog_background_metallic</item>
        <item name="dialogCornerRadius">16dp</item>
        <item name="colorPrimary">#000000</item>
        <item name="colorAccent">#000000</item>
    </style>

    <!-- TimePicker ä¸»é¢˜ -->
    <style name="Theme.WebSnap.TimePicker" parent="Theme.MaterialComponents.Light.Dialog.Alert">
        <item name="android:windowBackground">@drawable/dialog_background_timepicker</item>
        <item name="android:backgroundDimEnabled">true</item>
        <item name="android:backgroundDimAmount">0.5</item>
        <item name="android:colorBackground">#64B5F6</item>
        <item name="colorSurface">#64B5F6</item>
        <item name="colorOnSurface">#000000</item>
        <item name="colorPrimary">#000000</item>
        <item name="colorPrimaryVariant">#000000</item>
        <item name="colorSecondary">#000000</item>
        <item name="colorOnPrimary">#FFFFFF</item>
        <item name="colorOnSecondary">#FFFFFF</item>
        <item name="colorAccent">#000000</item>
        <item name="colorControlActivated">#000000</item>
        <item name="colorControlHighlight">#33000000</item>
        <item name="colorControlNormal">#000000</item>
        <item name="android:textColorPrimary">#000000</item>
        <item name="android:textColorSecondary">#000000</item>
        <item name="android:textColorHint">#333333</item>
        <item name="android:buttonBarButtonStyle">@style/Widget.WebSnap.TimePickerButton</item>
        <item name="buttonBarPositiveButtonStyle">@style/Widget.WebSnap.TimePickerButton</item>
        <item name="buttonBarNegativeButtonStyle">@style/Widget.WebSnap.TimePickerButton</item>
        <item name="buttonBarNeutralButtonStyle">@style/Widget.WebSnap.TimePickerButton</item>
    </style>

    <!-- TimePicker æŒ‰é’®æ ·å¼ -->
    <style name="Widget.WebSnap.TimePickerButton" parent="Widget.MaterialComponents.Button.TextButton">
        <item name="android:textColor">@color/button_text_color</item>
        <item name="android:textStyle">bold</item>
        <item name="android:textSize">14sp</item>
        <item name="backgroundTint">@null</item>
        <item name="android:background">@drawable/button_outline</item>
        <item name="android:stateListAnimator">@null</item>
        <item name="rippleColor">@android:color/transparent</item>
        <item name="android:minWidth">64dp</item>
        <item name="android:minHeight">40dp</item>
        <item name="android:layout_marginEnd">12dp</item>
        <item name="android:paddingHorizontal">8dp</item>
    </style>

    <!-- ç§’é€‰æ‹©å¯¹è¯æ¡†ä¸»é¢˜ -->
    <style name="Theme.WebSnap.SecondPicker" parent="Theme.MaterialComponents.Light.Dialog.Alert">
        <item name="android:windowBackground">@drawable/dialog_background_metallic</item>
        <item name="android:backgroundDimEnabled">true</item>
        <item name="android:backgroundDimAmount">0.5</item>
        <item name="android:colorBackground">#F5F5F5</item>
        <item name="colorSurface">#F5F5F5</item>
        <item name="colorOnSurface">#000000</item>
        <item name="colorPrimary">#000000</item>
        <item name="colorAccent">#000000</item>
        <item name="android:textColorPrimary">#000000</item>
        <item name="android:textColorSecondary">#333333</item>
        <item name="android:buttonBarButtonStyle">@style/Widget.WebSnap.SecondPickerButton</item>
        <item name="buttonBarPositiveButtonStyle">@style/Widget.WebSnap.SecondPickerButton</item>
        <item name="buttonBarNegativeButtonStyle">@style/Widget.WebSnap.SecondPickerButton</item>
    </style>

    <style name="Widget.WebSnap.SecondPickerButton" parent="Widget.MaterialComponents.Button.TextButton">
        <item name="android:textColor">@color/button_text_color</item>
        <item name="android:textStyle">bold</item>
        <item name="backgroundTint">@null</item>
        <item name="android:background">@drawable/button_outline</item>
        <item name="android:stateListAnimator">@null</item>
        <item name="rippleColor">@android:color/transparent</item>
    </style>

    <!-- è£å‰ªç•Œé¢ä¸»é¢˜ -->
    <style name="Theme.WebSnap.Crop" parent="Theme.MaterialComponents.Light.NoActionBar">
        <item name="android:statusBarColor">#000000</item>
        <item name="android:navigationBarColor">#000000</item>
        <item name="android:windowBackground">#000000</item>
    </style>
</resources>
</file>

<file path="app/src/main/res/xml/file_paths.xml">
<?xml version="1.0" encoding="utf-8"?>
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- ç›¸æœºæ‹ç…§ä¸´æ—¶å­˜å‚¨è·¯å¾„ -->
    <external-cache-path
        name="camera_photos"
        path="." />
    <cache-path
        name="internal_cache"
        path="." />
</paths>
</file>

<file path="app/src/main/res/xml/network_security_config.xml">
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <!-- 
        å…è®¸æ˜æ–‡ HTTP æµé‡ï¼ˆå®ƒç”¨äºè®¿é—® http:// ç½‘ç«™ï¼‰
    -->
    <base-config cleartextTrafficPermitted="true">
        <trust-anchors>
            <certificates src="system" />
        </trust-anchors>
    </base-config>
</network-security-config>
</file>

<file path="app/src/main/AndroidManifest.xml">
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!-- ç½‘ç»œæƒé™ -->
    <uses-permission android:name="android.permission.INTERNET" />

    <!-- å‰å°æœåŠ¡æƒé™ (Android 9+) -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />

    <!-- æ•°æ®åŒæ­¥ç±»å‹å‰å°æœåŠ¡ (Android 10+) -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />

    <!-- å…è®¸å‘é€é€šçŸ¥ (Android 13+) -->
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- å¤šåª’ä½“ä¸æ–‡ä»¶æƒé™ -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- ç›¸æœºæƒé™ -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-feature android:name="android.hardware.camera" android:required="false" />
    <uses-feature android:name="android.hardware.camera.autofocus" android:required="false" />

    <!-- éº¦å…‹é£æƒé™ -->
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
    <uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />

    <!-- Android 13+ ç»†ç²’åº¦åª’ä½“æƒé™ -->
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
    <uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />
    <uses-permission android:name="android.permission.READ_MEDIA_AUDIO" />

    <!-- Android 12 åŠä»¥ä¸‹å­˜å‚¨æƒé™ï¼ˆå‘åå…¼å®¹ï¼‰ -->
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"
        android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"
        android:maxSdkVersion="29"
        tools:ignore="ScopedStorage" />

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.WebSnap"
        android:networkSecurityConfig="@xml/network_security_config"
        tools:targetApi="33">

        <!-- ä¸» Activity -->
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:configChanges="orientation|screenSize|keyboardHidden"
            android:windowSoftInputMode="adjustResize"
            android:launchMode="singleTop">

            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <!-- è£å‰ª Activity -->
        <activity
            android:name=".CropActivity"
            android:exported="false"
            android:theme="@style/Theme.WebSnap.Crop"
            android:configChanges="orientation|screenSize|keyboardHidden" />

        <!-- è‡ªåŠ¨åˆ·æ–°å‰å°æœåŠ¡ -->
        <service
            android:name=".RefreshService"
            android:enabled="true"
            android:exported="false"
            android:foregroundServiceType="dataSync" />

        <!-- FileProvider ç”¨äºç›¸æœºæ‹ç…§ -->
        <provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${applicationId}.fileprovider"
            android:exported="false"
            android:grantUriPermissions="true">
            <meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/file_paths" />
        </provider>

    </application>

</manifest>
</file>

<file path="app/build.gradle.kts">
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
}

android {
    namespace = "com.example.websnap"
    compileSdk = 33

    defaultConfig {
        applicationId = "com.example.websnap"
        minSdk = 26
        targetSdk = 33
        versionCode = 1
        versionName = "1.0"
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
    }

    buildFeatures {
        viewBinding = true
    }
}

dependencies {
    implementation("androidx.core:core-ktx:1.10.1")
    implementation("androidx.appcompat:appcompat:1.6.1")
    implementation("com.google.android.material:material:1.9.0")
    implementation("androidx.constraintlayout:constraintlayout:2.1.4")
}
</file>

<file path="app/proguard-rules.pro">
# ============================================
# WebSnap ProGuard Rules
# ============================================
# ä¿ç•™è¡Œå·ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•å´©æºƒæ—¥å¿—
-keepattributes SourceFile,LineNumberTable

# ä¿ç•™ Parcelable å®ç°
-keepclassmembers class * implements android.os.Parcelable {
    public static final android.os.Parcelable$Creator CREATOR;
}
</file>

<file path=".gitignore">
# Gradle
.gradle/
build/
!gradle/wrapper/gradle-wrapper.jar

# Android Studio / IntelliJ IDEA
.idea/
*.iml
local.properties

# APK æ–‡ä»¶
*.apk
*.aab

# æ—¥å¿—
*.log

# ç³»ç»Ÿæ–‡ä»¶
.DS_Store
Thumbs.db

# æµ‹è¯•è¾“å‡º
/app/build/
/app/release/
</file>

<file path="build.gradle.kts">
plugins {
    id("com.android.application") version "8.1.0" apply false
    id("org.jetbrains.kotlin.android") version "1.9.0" apply false
}
</file>

<file path="gradle.properties">
# ============================================
# Project-wide Gradle settings
# ============================================
# å¯ç”¨ AndroidX
android.useAndroidX=true
# å¯ç”¨å¹¶è¡Œæ„å»º
org.gradle.parallel=true
# é…ç½® JVM å†…å­˜ï¼ˆGitHub Actions ç¯å¢ƒï¼‰
org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
# éä¼ é€’æ€§ R ç±»ï¼ˆå‡å°‘æ„å»ºæ—¶é—´ï¼‰
android.nonTransitiveRClass=true
# Kotlin ä»£ç é£æ ¼
kotlin.code.style=official
</file>

<file path="README.md">
# WebSnap
Android WebView Long Screenshot Tool.
</file>

<file path="settings.gradle.kts">
pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
    }
}

rootProject.name = "WebSnap"
include(":app")
</file>

</files>
